<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anshull Garg | Zen Garden Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;300;500;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --sand: #E8DCC8;
  --sand-dark: #D4C5A9;
  --sand-darker: #BFB08E;
  --stone-dark: #4A4A4A;
  --stone-warm: #6B5B4E;
  --stone-light: #8A7B6E;
  --moss: #5A7A52;
  --moss-light: #7A9A72;
  --blossom: #FFB7C5;
  --blossom-light: #FFD4DE;
  --water: #7BA7BC;
  --water-light: #9BC7DC;
  --water-dark: #5B8A9F;
  --bamboo: #8B9A46;
  --bamboo-dark: #6B7A36;
  --paper: #F5F0E8;
  --ink: #2A2A2A;
  --ink-light: #5A5A5A;
}

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  font-family: 'Inter', sans-serif;
  background: #D6CAAF;
  color: var(--ink);
  cursor: none;
  -webkit-user-select: none;
  user-select: none;
}

/* ── Custom Cursor ── */
#cursor-rake {
  position: fixed;
  pointer-events: none;
  z-index: 10000;
  width: 48px;
  height: 48px;
  transform: translate(-50%, -50%);
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
  transition: transform 0.1s ease-out;
  will-change: left, top;
}

#cursor-rake.raking {
  transform: translate(-50%, -50%) scale(0.92);
}

/* ── Garden Container ── */
#garden {
  position: relative;
  width: 100vw; height: 100vh;
  overflow: hidden;
  background: #D6CAAF;
}

/* Subtle base sand texture via SVG noise */
#garden::before {
  content: '';
  position: absolute;
  inset: 0;
  background: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.06'/%3E%3C/svg%3E");
  z-index: 0;
  pointer-events: none;
}

/* ── Canvas Layers ── */
#bg-canvas {
  position: absolute; inset: 0;
  z-index: 1;
  pointer-events: none;
}

#sand-canvas {
  position: absolute; inset: 0;
  z-index: 5;
  pointer-events: auto;
}

#fx-canvas {
  position: absolute; inset: 0;
  z-index: 6;
  pointer-events: none;
}

/* ── Bamboo Fence ── */
.bamboo-fence {
  position: absolute; z-index: 7;
  pointer-events: none;
  left: 0; right: 0;
}
.bamboo-fence-top {
  top: 0; height: 8px;
  background:
    linear-gradient(180deg, rgba(107,122,54,0.3), transparent),
    repeating-linear-gradient(90deg,
      var(--bamboo-dark) 0px, var(--bamboo-dark) 2px,
      var(--bamboo) 2px, var(--bamboo) 5px,
      transparent 5px, transparent 32px
    );
}
.bamboo-fence-bottom {
  bottom: 0; height: 8px;
  background:
    linear-gradient(0deg, rgba(107,122,54,0.3), transparent),
    repeating-linear-gradient(90deg,
      var(--bamboo-dark) 0px, var(--bamboo-dark) 2px,
      var(--bamboo) 2px, var(--bamboo) 5px,
      transparent 5px, transparent 32px
    );
}

/* ── Cherry Blossoms ── */
.petal {
  position: fixed; z-index: 8;
  pointer-events: none;
  border-radius: 50% 0 50% 50%;
  opacity: 0;
  will-change: transform, opacity;
}

@keyframes petalDrift {
  0% {
    transform: translate3d(0, -20px, 0) rotate(0deg) scale(0.6);
    opacity: 0;
  }
  8% { opacity: 0.7; }
  50% {
    transform: translate3d(calc(var(--dx) * 0.5), 45vh, 0) rotate(360deg) scale(0.9);
    opacity: 0.6;
  }
  85% { opacity: 0.4; }
  100% {
    transform: translate3d(var(--dx), calc(100vh + 30px), 0) rotate(720deg) scale(0.3);
    opacity: 0;
  }
}

/* ── Stones ── */
.stone-marker {
  position: absolute; z-index: 3;
  transform: translate(-50%, -50%);
  pointer-events: none;
}

.stone-shape {
  position: relative;
  display: flex; align-items: center; justify-content: center;
  opacity: 0;
  transform: scale(0.7) translateY(8px);
  transition: opacity 1.6s cubic-bezier(0.23, 1, 0.32, 1),
              transform 1.6s cubic-bezier(0.23, 1, 0.32, 1),
              box-shadow 1.6s ease;
  will-change: opacity, transform;
}

.stone-shape.revealed {
  opacity: 1;
  transform: scale(1) translateY(0);
}

.stone-shape.revealed:hover {
  box-shadow:
    0 8px 40px rgba(0,0,0,0.25),
    0 0 0 2px rgba(255,255,255,0.08),
    inset 0 -4px 16px rgba(0,0,0,0.2),
    inset 0 4px 8px rgba(255,255,255,0.06);
  cursor: none;
}

.stone-label {
  font-family: 'Noto Serif JP', serif;
  color: rgba(255,255,255,0.55);
  font-size: 0.6rem;
  font-weight: 300;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  text-align: center;
  padding: 10px;
  line-height: 1.6;
  pointer-events: auto;
  cursor: none;
  transition: color 0.4s;
}

.stone-shape.revealed .stone-label {
  color: rgba(255,255,255,0.65);
}

.stone-shape.revealed .stone-label:hover {
  color: rgba(255,255,255,0.85);
}

/* Individual stone shapes */
.stone-center {
  width: 200px; height: 155px;
  border-radius: 52% 48% 54% 46% / 46% 54% 48% 52%;
  background: linear-gradient(155deg, #5E5E5E 0%, #3D3D3D 40%, #2E2E2E 100%);
  box-shadow:
    0 12px 40px rgba(0,0,0,0.3),
    inset 0 -6px 20px rgba(0,0,0,0.25),
    inset 0 6px 12px rgba(255,255,255,0.04);
}

.stone-center .stone-label {
  font-size: 0.95rem;
  font-weight: 500;
  letter-spacing: 4px;
  color: rgba(255,255,255,0.6);
}

.stone-sm {
  border-radius: 48% 52% 55% 45% / 52% 48% 45% 55%;
  background: linear-gradient(145deg, var(--stone-light), var(--stone-dark));
  box-shadow:
    0 8px 28px rgba(0,0,0,0.25),
    inset 0 -4px 14px rgba(0,0,0,0.2),
    inset 0 3px 8px rgba(255,255,255,0.04);
}

.stone-1 { width: 110px; height: 88px; border-radius: 45% 55% 50% 50% / 50% 45% 55% 50%; }
.stone-2 { width: 100px; height: 82px; border-radius: 55% 45% 48% 52% / 48% 55% 45% 52%;
  background: linear-gradient(130deg, #7E6E60, #4E4440); }
.stone-3 { width: 105px; height: 85px; border-radius: 48% 52% 55% 45% / 52% 48% 45% 55%;
  background: linear-gradient(160deg, #8A7B6E, #524A42); }
.stone-4 { width: 95px; height: 78px; border-radius: 52% 48% 45% 55% / 55% 45% 52% 48%;
  background: linear-gradient(140deg, #7A6C60, #48403A); }
.stone-5 { width: 120px; height: 92px; border-radius: 50% 50% 48% 52% / 48% 52% 50% 50%;
  background: linear-gradient(150deg, #6E6058, #3E3836); }
.stone-6 { width: 98px; height: 80px; border-radius: 46% 54% 52% 48% / 54% 46% 48% 52%;
  background: linear-gradient(135deg, #807268, #504844); }

/* ── Moss Patches ── */
.moss {
  position: absolute; z-index: 2;
  pointer-events: none;
  border-radius: 60% 40% 55% 45% / 45% 55% 40% 60%;
  background: radial-gradient(ellipse, rgba(90,122,82,0.4), rgba(90,122,82,0.15), transparent 70%);
  opacity: 0;
  transition: opacity 3s ease;
}
.moss.show { opacity: 1; }

/* ── Scroll Panel ── */
#scroll-panel {
  position: fixed; z-index: 200;
  pointer-events: none;
  opacity: 0;
  transform: translateY(16px) scale(0.96);
  transition: opacity 0.5s cubic-bezier(0.23,1,0.32,1),
              transform 0.5s cubic-bezier(0.23,1,0.32,1);
  filter: drop-shadow(0 24px 48px rgba(0,0,0,0.12));
}

#scroll-panel.open {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0) scale(1);
}

.panel-scroll {
  background: linear-gradient(180deg, #F8F3EB, #F0EADF);
  border: 1px solid rgba(160, 140, 110, 0.25);
  border-radius: 6px;
  padding: 28px 32px;
  max-width: 400px;
  min-width: 280px;
  position: relative;
  overflow: hidden;
}

/* Washi texture */
.panel-scroll::before {
  content: '';
  position: absolute; inset: 0;
  background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events: none;
}

/* Red seal stamp decoration */
.panel-scroll::after {
  content: '';
  position: absolute;
  top: 20px; right: 20px;
  width: 28px; height: 28px;
  border: 2px solid rgba(180, 60, 50, 0.15);
  border-radius: 3px;
  transform: rotate(8deg);
}

.panel-title {
  font-family: 'Noto Serif JP', serif;
  font-weight: 500;
  font-size: 1rem;
  color: var(--ink);
  margin-bottom: 14px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(160, 140, 110, 0.2);
  letter-spacing: 1.5px;
}

.panel-body {
  font-size: 0.82rem;
  line-height: 1.85;
  color: var(--ink-light);
  font-weight: 300;
}

.panel-body strong {
  color: var(--ink);
  font-weight: 500;
}

.panel-body a {
  color: var(--water-dark);
  text-decoration: none;
  border-bottom: 1px solid rgba(91, 138, 159, 0.25);
  transition: border-color 0.3s, color 0.3s;
}
.panel-body a:hover {
  color: #4A7A90;
  border-color: #4A7A90;
}

.skill-tag {
  display: inline-block;
  padding: 3px 10px;
  margin: 3px 2px;
  font-size: 0.72rem;
  background: rgba(90, 122, 82, 0.08);
  color: var(--moss);
  border: 1px solid rgba(90, 122, 82, 0.18);
  border-radius: 2px;
  font-weight: 400;
  letter-spacing: 0.5px;
}

.tl-entry {
  padding-left: 14px;
  border-left: 2px solid rgba(74, 74, 74, 0.15);
  margin-bottom: 14px;
}
.tl-entry:last-child { margin-bottom: 0; }
.tl-date {
  font-size: 0.68rem;
  color: var(--moss);
  font-weight: 500;
  letter-spacing: 1px;
  text-transform: uppercase;
}
.tl-role {
  font-family: 'Noto Serif JP', serif;
  font-weight: 500;
  font-size: 0.88rem;
  margin: 3px 0;
  color: var(--ink);
}
.tl-desc {
  font-size: 0.78rem;
  line-height: 1.65;
}

/* ── Panel Close Hint ── */
.panel-close-hint {
  font-size: 0.6rem;
  color: rgba(160, 140, 110, 0.5);
  text-align: center;
  margin-top: 16px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

/* ── Instructions ── */
#instructions {
  position: fixed; inset: 0;
  z-index: 500;
  display: flex; align-items: center; justify-content: center;
  flex-direction: column;
  background: var(--sand);
  transition: opacity 2s ease;
}

#instructions.fade-out {
  opacity: 0;
  pointer-events: none;
}

.inst-title {
  font-family: 'Noto Serif JP', serif;
  font-weight: 200;
  font-size: 2.8rem;
  letter-spacing: 12px;
  color: var(--ink);
  margin-bottom: 6px;
}

.inst-subtitle {
  font-size: 0.72rem;
  letter-spacing: 5px;
  text-transform: uppercase;
  color: var(--ink-light);
  margin-bottom: 48px;
  font-weight: 300;
}

.inst-haiku {
  font-family: 'Noto Serif JP', serif;
  font-weight: 300;
  font-size: 0.88rem;
  color: var(--stone-warm);
  line-height: 2.2;
  text-align: center;
  font-style: italic;
}

.inst-action {
  margin-top: 48px;
  font-size: 0.65rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--sand-darker);
  animation: pulse 3s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

/* Decorative line above haiku */
.inst-line {
  width: 40px;
  height: 1px;
  background: var(--sand-darker);
  margin-bottom: 32px;
  opacity: 0.5;
}

/* ── UI Controls ── */
#ui-bar {
  position: fixed; bottom: 0; left: 0; right: 0;
  z-index: 150;
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 24px;
  pointer-events: none;
}

#ui-bar > * { pointer-events: auto; }

.ui-text {
  font-size: 0.6rem;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--sand-darker);
  font-weight: 400;
  opacity: 0.7;
}

.ui-btn {
  font-family: 'Noto Serif JP', serif;
  font-size: 0.6rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink-light);
  background: rgba(245,240,232,0.6);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(74, 74, 74, 0.1);
  border-radius: 3px;
  padding: 7px 14px;
  cursor: none;
  opacity: 0;
  transition: opacity 0.6s, background 0.3s;
}
.ui-btn.show { opacity: 0.7; }
.ui-btn:hover { opacity: 1; background: rgba(245,240,232,0.9); }

.ui-sound {
  width: 32px; height: 32px;
  border: 1px solid rgba(74, 74, 74, 0.12);
  border-radius: 50%;
  background: rgba(245,240,232,0.5);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  cursor: none;
  font-size: 13px;
  color: var(--ink-light);
  opacity: 0.5;
  transition: opacity 0.3s;
}
.ui-sound:hover { opacity: 1; }
.ui-sound.active { opacity: 0.9; color: var(--moss); }

/* ── Responsive ── */
@media (max-width: 768px) {
  .stone-center { width: 140px; height: 108px; }
  .stone-center .stone-label { font-size: 0.8rem; letter-spacing: 3px; }
  .stone-sm { transform: scale(0.85); }
  .panel-scroll { max-width: 88vw; min-width: unset; padding: 22px 24px; }
  .inst-title { font-size: 1.8rem; letter-spacing: 8px; }
}
</style>
</head>
<body>

<!-- ── Custom Rake Cursor ── -->
<svg id="cursor-rake" viewBox="0 0 48 48" fill="none">
  <g opacity="0.85">
    <!-- Handle -->
    <line x1="24" y1="14" x2="24" y2="42" stroke="#6B5B4E" stroke-width="2.5" stroke-linecap="round"/>
    <!-- Crossbar -->
    <line x1="10" y1="11" x2="38" y2="11" stroke="#6B5B4E" stroke-width="2" stroke-linecap="round"/>
    <!-- Tines -->
    <line x1="13" y1="11" x2="13" y2="20" stroke="#6B5B4E" stroke-width="1.5" stroke-linecap="round"/>
    <line x1="18" y1="11" x2="18" y2="20" stroke="#6B5B4E" stroke-width="1.5" stroke-linecap="round"/>
    <line x1="24" y1="11" x2="24" y2="20" stroke="#6B5B4E" stroke-width="1.5" stroke-linecap="round"/>
    <line x1="30" y1="11" x2="30" y2="20" stroke="#6B5B4E" stroke-width="1.5" stroke-linecap="round"/>
    <line x1="35" y1="11" x2="35" y2="20" stroke="#6B5B4E" stroke-width="1.5" stroke-linecap="round"/>
  </g>
</svg>

<!-- ── Instructions ── -->
<div id="instructions">
  <div class="inst-title">Zen Garden</div>
  <div class="inst-subtitle">Portfolio of Anshull Garg</div>
  <div class="inst-line"></div>
  <div class="inst-haiku">
    Rake the sand to find<br>
    stones that hold the story's truth --<br>
    silence speaks the most.
  </div>
  <div class="inst-action">Move your cursor to begin</div>
</div>

<!-- ── Garden ── -->
<div id="garden">
  <canvas id="bg-canvas"></canvas>
  <canvas id="sand-canvas"></canvas>
  <canvas id="fx-canvas"></canvas>
  <div class="bamboo-fence bamboo-fence-top"></div>
  <div class="bamboo-fence bamboo-fence-bottom"></div>

  <!-- Moss -->
  <div class="moss" style="width:140px;height:90px;top:13%;left:6%;"></div>
  <div class="moss" style="width:100px;height:65px;top:72%;left:76%;border-radius:50% 45% 60% 40%/40% 60% 45% 55%;"></div>
  <div class="moss" style="width:80px;height:55px;top:82%;left:18%;border-radius:40% 55% 45% 60%/55% 40% 60% 45%;"></div>
  <div class="moss" style="width:60px;height:42px;top:28%;left:62%;border-radius:55% 40% 50% 45%/45% 55% 45% 50%;"></div>
  <div class="moss" style="width:50px;height:35px;top:58%;left:90%;border-radius:45% 55% 45% 55%/55% 45% 55% 45%;"></div>

  <!-- Stones -->
  <div class="stone-marker" id="s-center" style="left:50%;top:50%;">
    <div class="stone-shape stone-center">
      <span class="stone-label">Anshull<br>Garg</span>
    </div>
  </div>

  <div class="stone-marker" id="s-about" style="left:24%;top:26%;" data-key="about">
    <div class="stone-shape stone-sm stone-1">
      <span class="stone-label">About</span>
    </div>
  </div>

  <div class="stone-marker" id="s-skills" style="left:70%;top:22%;" data-key="skills">
    <div class="stone-shape stone-sm stone-2">
      <span class="stone-label">Skills</span>
    </div>
  </div>

  <div class="stone-marker" id="s-proj1" style="left:16%;top:58%;" data-key="proj1">
    <div class="stone-shape stone-sm stone-3">
      <span class="stone-label">Project</span>
    </div>
  </div>

  <div class="stone-marker" id="s-proj2" style="left:58%;top:70%;" data-key="proj2">
    <div class="stone-shape stone-sm stone-4">
      <span class="stone-label">Project</span>
    </div>
  </div>

  <div class="stone-marker" id="s-exp" style="left:80%;top:44%;" data-key="exp">
    <div class="stone-shape stone-sm stone-5">
      <span class="stone-label">Experience</span>
    </div>
  </div>

  <div class="stone-marker" id="s-contact" style="left:38%;top:82%;" data-key="contact">
    <div class="stone-shape stone-sm stone-6">
      <span class="stone-label">Contact</span>
    </div>
  </div>
</div>

<!-- ── Scroll Panel ── -->
<div id="scroll-panel">
  <div class="panel-scroll">
    <div class="panel-title" id="p-title"></div>
    <div class="panel-body" id="p-body"></div>
    <div class="panel-close-hint">click anywhere to close</div>
  </div>
</div>

<!-- ── Bottom UI ── -->
<div id="ui-bar">
  <div class="ui-text"><span id="count">0</span> / 7 stones</div>
  <div style="display:flex;gap:10px;align-items:center;">
    <button class="ui-btn" id="btn-reset" onclick="resetGarden()">Smooth Sand</button>
    <button class="ui-sound" id="btn-sound" onclick="toggleSound()">&#9835;</button>
  </div>
</div>

<script>
// ════════════════════════════════════════════════
// ZEN GARDEN PORTFOLIO  -  Anshull Garg
// ════════════════════════════════════════════════

// ── Canvases ──
const sandCvs = document.getElementById('sand-canvas');
const sandCtx = sandCvs.getContext('2d');
const bgCvs = document.getElementById('bg-canvas');
const bgCtx = bgCvs.getContext('2d');
const fxCvs = document.getElementById('fx-canvas');
const fxCtx = fxCvs.getContext('2d');

let W, H;

// ── State ──
let mx = -200, my = -200, pmx = -200, pmy = -200;
let started = false;
let revealed = new Set();
let panelOpen = null;
let audioCtx = null, audioPlaying = false;

// ── Sand Grid ──
// Instead of pixel-by-pixel, we use a coarser grid + canvas composite
// The sand canvas starts opaque (sand color) and we erase it to reveal below
const CELL = 3;
let cols, rows, grid; // grid: 1=sand, 0=raked

// ── Noise texture (pre-generated) ──
let noiseImageData = null;

// ── Stone positions (relative) ──
const stones = [
  { id: 's-center',  rx: 0.50, ry: 0.50, r: 80  },
  { id: 's-about',   rx: 0.24, ry: 0.26, r: 55  },
  { id: 's-skills',  rx: 0.70, ry: 0.22, r: 50  },
  { id: 's-proj1',   rx: 0.16, ry: 0.58, r: 52  },
  { id: 's-proj2',   rx: 0.58, ry: 0.70, r: 48  },
  { id: 's-exp',     rx: 0.80, ry: 0.44, r: 58  },
  { id: 's-contact', rx: 0.38, ry: 0.82, r: 50  },
];

// ── Panel Data ──
const panels = {
  about: {
    title: 'About',
    html: `<p><strong>Anshull Garg</strong> is a Software Developer at <strong>Walmart Global Tech</strong>, building scalable systems that serve millions of customers daily.</p>
<br><p>With a deep passion for clean architecture, performance engineering, and thoughtful user experiences, he brings a meticulous engineering mindset to everything he builds.</p>
<br><p>When not writing code, you might find him exploring new technologies, contributing to open source, or contemplating the art of simplicity -- much like tending a zen garden.</p>`
  },
  skills: {
    title: 'Skills',
    html: `<p style="margin-bottom:10px;font-size:0.72rem;color:var(--ink-light);">Core competencies, cultivated with care.</p>
<div>
<span class="skill-tag">JavaScript</span><span class="skill-tag">TypeScript</span><span class="skill-tag">React</span><span class="skill-tag">Node.js</span><span class="skill-tag">Python</span><span class="skill-tag">Java</span><span class="skill-tag">Go</span><span class="skill-tag">SQL</span><span class="skill-tag">GraphQL</span><span class="skill-tag">REST APIs</span><span class="skill-tag">Microservices</span><span class="skill-tag">Docker</span><span class="skill-tag">Kubernetes</span><span class="skill-tag">AWS</span><span class="skill-tag">GCP</span><span class="skill-tag">CI/CD</span><span class="skill-tag">System Design</span><span class="skill-tag">Performance</span><span class="skill-tag">Agile</span>
</div>`
  },
  proj1: {
    title: 'Inventory Intelligence Platform',
    html: `<p><strong>Real-time inventory management</strong> system handling millions of SKUs across thousands of Walmart stores.</p>
<br><p>Built a reactive data pipeline processing inventory events in real-time, enabling accurate stock visibility and reducing out-of-stock incidents by 30%.</p>
<br><p style="font-size:0.72rem;color:var(--moss);">React &middot; Node.js &middot; Kafka &middot; Redis &middot; Kubernetes</p>`
  },
  proj2: {
    title: 'Checkout Optimization Engine',
    html: `<p><strong>Performance-critical checkout flow</strong> serving millions of daily transactions on walmart.com.</p>
<br><p>Led frontend optimization efforts that reduced checkout page load times by 40% and improved conversion rates. Implemented code splitting, lazy hydration, and edge caching strategies.</p>
<br><p style="font-size:0.72rem;color:var(--moss);">React &middot; Next.js &middot; GraphQL &middot; Edge Computing &middot; A/B Testing</p>`
  },
  exp: {
    title: 'Experience',
    html: `<div class="tl-entry">
<div class="tl-date">2022 &mdash; Present</div>
<div class="tl-role">Software Developer, Walmart Global Tech</div>
<div class="tl-desc">Building scalable e-commerce systems serving millions of customers. Focus on performance, reliability, and developer experience across the full stack.</div>
</div>
<div class="tl-entry">
<div class="tl-date">Education</div>
<div class="tl-role">B.Tech Computer Science</div>
<div class="tl-desc">Strong foundation in algorithms, distributed systems, and software engineering principles.</div>
</div>`
  },
  contact: {
    title: 'Contact',
    html: `<p style="margin-bottom:14px;font-style:italic;color:var(--stone-warm);font-size:0.8rem;">Like a stone in the garden, the best connections endure.</p>
<p><strong>Email</strong><br><a href="mailto:anshull.garg@outlook.com">anshull.garg@outlook.com</a></p><br>
<p><strong>LinkedIn</strong><br><a href="https://linkedin.com/in/anshullgarg" target="_blank" rel="noopener">linkedin.com/in/anshullgarg</a></p><br>
<p><strong>GitHub</strong><br><a href="https://github.com/anshullgarg" target="_blank" rel="noopener">github.com/anshullgarg</a></p>`
  }
};

// ════════════════════════════════════════════════
// INITIALIZATION
// ════════════════════════════════════════════════

function init() {
  resize();
  buildSandTexture();
  drawBackground();
  drawSandFull();
  bindEvents();
  spawnPetalsLoop();
  requestAnimationFrame(tick);
}

function resize() {
  W = window.innerWidth;
  H = window.innerHeight;
  [sandCvs, bgCvs, fxCvs].forEach(c => { c.width = W; c.height = H; });
  cols = Math.ceil(W / CELL);
  rows = Math.ceil(H / CELL);
  grid = new Uint8Array(cols * rows);
  grid.fill(1);
}

// ════════════════════════════════════════════════
// SAND TEXTURE  (pre-baked noise)
// ════════════════════════════════════════════════

function buildSandTexture() {
  noiseImageData = sandCtx.createImageData(W, H);
  const d = noiseImageData.data;
  // Sand base: rgb(232, 220, 200) = #E8DCC8
  const bR = 232, bG = 220, bB = 200;
  for (let i = 0; i < d.length; i += 4) {
    const n = (Math.random() - 0.5) * 12;
    d[i]   = bR + n;
    d[i+1] = bG + n;
    d[i+2] = bB + n;
    d[i+3] = 255;
  }
}

function drawSandFull() {
  sandCtx.putImageData(noiseImageData, 0, 0);
  // Now cut out raked areas
  applyRakeToCanvas();
}

// Apply the grid state to the sand canvas using compositing
function applyRakeToCanvas() {
  // For every cell that is raked (0), we make the sand semi-transparent
  // This reveals the background (decorative layer + base color)
  sandCtx.save();
  sandCtx.globalCompositeOperation = 'destination-out';

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      if (grid[r * cols + c] === 0) {
        sandCtx.fillStyle = 'rgba(0,0,0,0.85)';
        sandCtx.fillRect(c * CELL, r * CELL, CELL, CELL);
      }
    }
  }

  sandCtx.restore();
}

// ════════════════════════════════════════════════
// RAKING  (fast path - only update changed cells)
// ════════════════════════════════════════════════

let dirtyMin = null, dirtyMax = null;

function rakeStroke(x0, y0, x1, y1) {
  const dx = x1 - x0, dy = y1 - y0;
  const dist = Math.hypot(dx, dy);
  if (dist < 0.5) return;

  const steps = Math.max(1, Math.ceil(dist / 1.5));
  const nx = -dy / dist, ny = dx / dist; // perpendicular

  const TINES = 5;
  const SPACING = 5;
  const HALF = (TINES - 1) * SPACING / 2;

  for (let s = 0; s <= steps; s++) {
    const t = s / steps;
    const cx = x0 + dx * t;
    const cy = y0 + dy * t;

    for (let i = 0; i < TINES; i++) {
      const off = i * SPACING - HALF;
      const tx = cx + nx * off;
      const ty = cy + ny * off;

      // Mark grid cells in a small radius around each tine
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          const gc = Math.floor((tx + dc * CELL * 0.5) / CELL);
          const gr = Math.floor((ty + dr * CELL * 0.5) / CELL);
          if (gc >= 0 && gc < cols && gr >= 0 && gr < rows) {
            const gi = gr * cols + gc;
            if (grid[gi] === 1) {
              grid[gi] = 0;
              // Track dirty region
              if (!dirtyMin) {
                dirtyMin = { c: gc, r: gr };
                dirtyMax = { c: gc, r: gr };
              } else {
                dirtyMin.c = Math.min(dirtyMin.c, gc);
                dirtyMin.r = Math.min(dirtyMin.r, gr);
                dirtyMax.c = Math.max(dirtyMax.c, gc);
                dirtyMax.r = Math.max(dirtyMax.r, gr);
              }
            }
          }
        }
      }
    }

    // Wider soft area between tines
    for (let off = -HALF - 4; off <= HALF + 4; off += 2) {
      const tx = cx + nx * off;
      const ty = cy + ny * off;
      const gc = Math.floor(tx / CELL);
      const gr = Math.floor(ty / CELL);
      if (gc >= 0 && gc < cols && gr >= 0 && gr < rows) {
        const gi = gr * cols + gc;
        if (grid[gi] === 1) {
          grid[gi] = 0;
          if (!dirtyMin) {
            dirtyMin = { c: gc, r: gr };
            dirtyMax = { c: gc, r: gr };
          } else {
            dirtyMin.c = Math.min(dirtyMin.c, gc);
            dirtyMin.r = Math.min(dirtyMin.r, gr);
            dirtyMax.c = Math.max(dirtyMax.c, gc);
            dirtyMax.r = Math.max(dirtyMax.r, gr);
          }
        }
      }
    }
  }
}

function flushDirty() {
  if (!dirtyMin) return;

  const pad = 4;
  const c0 = Math.max(0, dirtyMin.c - pad);
  const r0 = Math.max(0, dirtyMin.r - pad);
  const c1 = Math.min(cols - 1, dirtyMax.c + pad);
  const r1 = Math.min(rows - 1, dirtyMax.r + pad);

  sandCtx.save();
  sandCtx.globalCompositeOperation = 'destination-out';

  for (let r = r0; r <= r1; r++) {
    for (let c = c0; c <= c1; c++) {
      if (grid[r * cols + c] === 0) {
        sandCtx.fillStyle = 'rgba(0,0,0,0.92)';
        sandCtx.fillRect(c * CELL, r * CELL, CELL, CELL);
      }
    }
  }

  sandCtx.restore();

  // Draw rake grooves on FX layer (parallel lines effect)
  drawRakeGrooves(c0, r0, c1, r1);

  dirtyMin = null;
  dirtyMax = null;
}

// ── Rake groove rendering on FX canvas ──
function drawRakeGrooves(c0, r0, c1, r1) {
  // Subtle dark lines in the raked area for that zen garden look
  fxCtx.save();
  fxCtx.globalAlpha = 0.12;
  fxCtx.strokeStyle = '#8A7B6E';
  fxCtx.lineWidth = 0.5;

  const px0 = c0 * CELL, py0 = r0 * CELL;
  const px1 = (c1 + 1) * CELL, py1 = (r1 + 1) * CELL;

  // Draw horizontal groove lines every 5px in the raked area
  for (let y = py0; y <= py1; y += 5) {
    fxCtx.beginPath();
    let drawing = false;
    for (let x = px0; x <= px1; x += CELL) {
      const gc = Math.floor(x / CELL);
      const gr = Math.floor(y / CELL);
      if (gc >= 0 && gc < cols && gr >= 0 && gr < rows && grid[gr * cols + gc] === 0) {
        if (!drawing) { fxCtx.moveTo(x, y); drawing = true; }
        else fxCtx.lineTo(x, y);
      } else {
        drawing = false;
      }
    }
    fxCtx.stroke();
  }

  fxCtx.restore();
}

// ════════════════════════════════════════════════
// STONE REVEAL DETECTION
// ════════════════════════════════════════════════

function checkReveals() {
  for (const s of stones) {
    if (revealed.has(s.id)) continue;

    const cx = s.rx * W, cy = s.ry * H;
    const checkR = s.r * 0.7;
    let total = 0, count = 0;

    for (let dy = -checkR; dy <= checkR; dy += CELL * 3) {
      for (let dx = -checkR; dx <= checkR; dx += CELL * 3) {
        if (dx*dx + dy*dy > checkR*checkR) continue;
        const gc = Math.floor((cx + dx) / CELL);
        const gr = Math.floor((cy + dy) / CELL);
        if (gc >= 0 && gc < cols && gr >= 0 && gr < rows) {
          total += grid[gr * cols + gc];
          count++;
        }
      }
    }

    const coverage = count > 0 ? total / count : 1;
    if (coverage < 0.5) {
      revealStone(s.id);
    }
  }
}

function revealStone(id) {
  revealed.add(id);
  const el = document.getElementById(id);
  if (el) {
    const shape = el.querySelector('.stone-shape');
    if (shape) shape.classList.add('revealed');
  }

  document.getElementById('count').textContent = revealed.size;

  if (revealed.size >= 1) {
    document.getElementById('btn-reset').classList.add('show');
  }
  if (revealed.size >= 2) {
    document.querySelectorAll('.moss').forEach(m => m.classList.add('show'));
  }
}

// ════════════════════════════════════════════════
// BACKGROUND - Water, Bonsai, Lantern, Bridge, Circles
// ════════════════════════════════════════════════

function drawBackground() {
  bgCtx.clearRect(0, 0, W, H);

  // 1. Gravel base (must be first)
  drawGravelBase();

  // 2. Zen circles (concentric rings)
  drawZenCircles(W * 0.5, H * 0.5, 100, 280, 16);
  drawZenCircles(W * 0.24, H * 0.26, 60, 130, 14);
  drawZenCircles(W * 0.80, H * 0.44, 65, 140, 15);

  // 3. Water stream
  drawWater();

  // 4. Bridge over water
  drawBridge();

  // 5. Bonsai tree
  drawBonsai();

  // 6. Stone lantern
  drawLantern();
}

function drawZenCircles(cx, cy, rMin, rMax, gap) {
  bgCtx.save();
  bgCtx.strokeStyle = 'rgba(180, 165, 135, 0.18)';
  bgCtx.lineWidth = 1;
  for (let r = rMin; r < rMax; r += gap) {
    bgCtx.beginPath();
    bgCtx.arc(cx, cy, r, 0, Math.PI * 2);
    bgCtx.stroke();
  }
  bgCtx.restore();
}

function drawGravelBase() {
  // Grain texture for the revealed gravel beneath the sand
  const id = bgCtx.createImageData(W, H);
  const d = id.data;
  for (let i = 0; i < d.length; i += 4) {
    const v = 195 + (Math.random() - 0.5) * 18;
    d[i]   = v + 10;  // warm bias
    d[i+1] = v + 3;
    d[i+2] = v - 12;
    d[i+3] = 255;
  }
  bgCtx.putImageData(id, 0, 0);
}

function drawWater() {
  bgCtx.save();

  const pts = [
    { x: W * 0.03, y: H * 0.30 },
    { x: W * 0.08, y: H * 0.42 },
    { x: W * 0.06, y: H * 0.55 },
    { x: W * 0.12, y: H * 0.68 },
    { x: W * 0.22, y: H * 0.78 },
    { x: W * 0.30, y: H * 0.92 },
  ];

  // Wide glow
  bgCtx.beginPath();
  bgCtx.moveTo(pts[0].x, pts[0].y);
  for (let i = 1; i < pts.length - 1; i += 2) {
    bgCtx.quadraticCurveTo(pts[i].x, pts[i].y, pts[i+1].x, pts[i+1].y);
  }
  bgCtx.lineWidth = 42;
  bgCtx.strokeStyle = 'rgba(123, 167, 188, 0.12)';
  bgCtx.lineCap = 'round';
  bgCtx.lineJoin = 'round';
  bgCtx.stroke();

  // Mid
  bgCtx.lineWidth = 24;
  bgCtx.strokeStyle = 'rgba(123, 167, 188, 0.18)';
  bgCtx.stroke();

  // Core
  bgCtx.lineWidth = 10;
  bgCtx.strokeStyle = 'rgba(155, 199, 220, 0.22)';
  bgCtx.stroke();

  // Highlight
  bgCtx.lineWidth = 3;
  bgCtx.strokeStyle = 'rgba(210, 235, 245, 0.15)';
  bgCtx.stroke();

  bgCtx.restore();
}

function drawBridge() {
  const bx = W * 0.12, by = H * 0.62;
  bgCtx.save();
  bgCtx.translate(bx, by);

  bgCtx.strokeStyle = 'rgba(120, 100, 75, 0.3)';

  // Arc
  bgCtx.lineWidth = 3.5;
  bgCtx.beginPath();
  bgCtx.arc(0, 8, 32, Math.PI, 0);
  bgCtx.stroke();

  // Rail
  bgCtx.lineWidth = 1.5;
  bgCtx.beginPath();
  bgCtx.arc(0, 8, 36, Math.PI + 0.12, -0.12);
  bgCtx.stroke();

  // Planks
  bgCtx.lineWidth = 1.5;
  for (let i = -26; i <= 26; i += 7) {
    const a = Math.acos(Math.max(-1, Math.min(1, i / 32)));
    const ty = 8 - Math.sin(a) * 32;
    bgCtx.beginPath();
    bgCtx.moveTo(i, ty - 1);
    bgCtx.lineTo(i, ty + 2.5);
    bgCtx.stroke();
  }

  bgCtx.restore();
}

function drawBonsai() {
  const bx = W * 0.90, by = H * 0.14;
  bgCtx.save();
  bgCtx.translate(bx, by);

  // Pot
  bgCtx.fillStyle = 'rgba(107, 91, 78, 0.45)';
  bgCtx.beginPath();
  bgCtx.moveTo(-18, 18);
  bgCtx.lineTo(-14, 32);
  bgCtx.lineTo(14, 32);
  bgCtx.lineTo(18, 18);
  bgCtx.closePath();
  bgCtx.fill();

  bgCtx.beginPath();
  bgCtx.ellipse(0, 18, 20, 5, 0, 0, Math.PI * 2);
  bgCtx.fill();

  // Trunk
  bgCtx.strokeStyle = 'rgba(85, 65, 50, 0.45)';
  bgCtx.lineWidth = 4.5;
  bgCtx.lineCap = 'round';
  bgCtx.beginPath();
  bgCtx.moveTo(0, 18);
  bgCtx.bezierCurveTo(-2, 4, 6, -8, -4, -22);
  bgCtx.stroke();

  // Branches
  bgCtx.lineWidth = 2;
  bgCtx.beginPath();
  bgCtx.moveTo(-1, -6);
  bgCtx.bezierCurveTo(12, -12, 20, -10, 24, -14);
  bgCtx.stroke();

  bgCtx.beginPath();
  bgCtx.moveTo(-3, -16);
  bgCtx.bezierCurveTo(-16, -22, -22, -20, -26, -24);
  bgCtx.stroke();

  bgCtx.beginPath();
  bgCtx.moveTo(-4, -22);
  bgCtx.bezierCurveTo(2, -30, 8, -28, 12, -30);
  bgCtx.stroke();

  // Foliage
  const fol = (x, y, r) => {
    bgCtx.fillStyle = 'rgba(80, 112, 72, 0.3)';
    bgCtx.beginPath();
    bgCtx.ellipse(x, y, r * 1.2, r * 0.85, 0.2, 0, Math.PI * 2);
    bgCtx.fill();
    bgCtx.fillStyle = 'rgba(60, 92, 52, 0.18)';
    bgCtx.beginPath();
    bgCtx.arc(x - 1, y - 1, r * 0.6, 0, Math.PI * 2);
    bgCtx.fill();
  };
  fol(-4, -28, 14);
  fol(-26, -26, 9);
  fol(24, -17, 10);
  fol(12, -32, 8);
  fol(-14, -30, 7);

  bgCtx.restore();
}

function drawLantern() {
  const lx = W * 0.42, ly = H * 0.90;
  bgCtx.save();
  bgCtx.translate(lx, ly);

  const c = 'rgba(74, 74, 74, 0.32)';

  // Base
  bgCtx.fillStyle = c;
  bgCtx.fillRect(-14, 8, 28, 5);

  // Pillar
  bgCtx.fillRect(-3, -16, 6, 24);

  // Body
  bgCtx.fillRect(-12, -30, 24, 15);

  // Windows (glow)
  bgCtx.fillStyle = 'rgba(255, 215, 140, 0.25)';
  bgCtx.fillRect(-9, -28, 7, 10);
  bgCtx.fillRect(2, -28, 7, 10);

  // Roof
  bgCtx.fillStyle = c;
  bgCtx.beginPath();
  bgCtx.moveTo(-18, -30);
  bgCtx.lineTo(0, -43);
  bgCtx.lineTo(18, -30);
  bgCtx.closePath();
  bgCtx.fill();

  // Finial
  bgCtx.fillRect(-2, -47, 4, 5);
  bgCtx.beginPath();
  bgCtx.arc(0, -48, 3, 0, Math.PI * 2);
  bgCtx.fill();

  bgCtx.restore();
}

// ════════════════════════════════════════════════
// CHERRY BLOSSOM PETALS
// ════════════════════════════════════════════════

function spawnPetalsLoop() {
  setInterval(() => {
    if (!started) return;
    for (let i = 0; i < 2; i++) createPetal();
  }, 2500);

  // Initial burst (delayed)
  setTimeout(() => {
    if (started) for (let i = 0; i < 5; i++) createPetal();
  }, 3000);
}

function createPetal() {
  const el = document.createElement('div');
  el.className = 'petal';
  const size = 5 + Math.random() * 9;
  el.style.width = size + 'px';
  el.style.height = size * 0.8 + 'px';
  el.style.left = (Math.random() * 105 - 5) + '%';
  el.style.top = '-20px';

  const hue = 338 + Math.random() * 18;
  const sat = 65 + Math.random() * 35;
  const lit = 78 + Math.random() * 14;
  el.style.background = `hsl(${hue}, ${sat}%, ${lit}%)`;
  el.style.boxShadow = `0 0 ${size/2}px rgba(255,183,197,0.2)`;

  const drift = (Math.random() - 0.3) * 180;
  el.style.setProperty('--dx', drift + 'px');

  const dur = 10 + Math.random() * 14;
  el.style.animation = `petalDrift ${dur}s ease-in-out forwards`;
  el.style.animationDelay = (Math.random() * 2) + 's';

  document.body.appendChild(el);
  setTimeout(() => el.remove(), (dur + 3) * 1000);
}

// ════════════════════════════════════════════════
// EVENT HANDLING
// ════════════════════════════════════════════════

function bindEvents() {
  document.addEventListener('mousemove', onMove);
  document.addEventListener('mousedown', onClick);
  document.addEventListener('touchstart', onTouchStart, { passive: false });
  document.addEventListener('touchmove', onTouchMove, { passive: false });
  document.addEventListener('touchend', () => {});
  window.addEventListener('resize', () => {
    resize();
    buildSandTexture();
    drawBackground();
    drawSandFull();
  });
}

function dismissIntro() {
  if (started) return;
  started = true;
  const inst = document.getElementById('instructions');
  inst.classList.add('fade-out');
  setTimeout(() => inst.style.display = 'none', 2200);
}

function onMove(e) {
  pmx = mx; pmy = my;
  mx = e.clientX; my = e.clientY;

  // Cursor
  const cur = document.getElementById('cursor-rake');
  cur.style.left = mx + 'px';
  cur.style.top = my + 'px';

  dismissIntro();

  if (pmx > -100) {
    const d = Math.hypot(mx - pmx, my - pmy);
    if (d > 0.5) {
      cur.classList.add('raking');
      clearTimeout(cur._rkTimer);
      cur._rkTimer = setTimeout(() => cur.classList.remove('raking'), 100);

      rakeStroke(pmx, pmy, mx, my);
    }
  }
}

function onClick(e) {
  // Check if clicking a revealed stone
  for (const s of stones) {
    if (!revealed.has(s.id)) continue;
    const el = document.getElementById(s.id);
    const key = el.getAttribute('data-key');
    if (!key) continue;

    const sx = s.rx * W, sy = s.ry * H;
    const d = Math.hypot(e.clientX - sx, e.clientY - sy);
    if (d < s.r) {
      if (panelOpen === key) { closePanel(); return; }
      openPanel(key, sx, sy);
      return;
    }
  }

  if (panelOpen) closePanel();
}

function onTouchStart(e) {
  e.preventDefault();
  const t = e.touches[0];
  pmx = mx; pmy = my;
  mx = t.clientX; my = t.clientY;
  dismissIntro();

  // Check stone tap
  for (const s of stones) {
    if (!revealed.has(s.id)) continue;
    const el = document.getElementById(s.id);
    const key = el.getAttribute('data-key');
    if (!key) continue;
    const sx = s.rx * W, sy = s.ry * H;
    if (Math.hypot(mx - sx, my - sy) < s.r) {
      if (panelOpen === key) { closePanel(); return; }
      openPanel(key, sx, sy);
      return;
    }
  }

  if (panelOpen) closePanel();
}

function onTouchMove(e) {
  e.preventDefault();
  const t = e.touches[0];
  pmx = mx; pmy = my;
  mx = t.clientX; my = t.clientY;

  const cur = document.getElementById('cursor-rake');
  cur.style.left = mx + 'px';
  cur.style.top = my + 'px';

  const d = Math.hypot(mx - pmx, my - pmy);
  if (d > 0.5) rakeStroke(pmx, pmy, mx, my);
}

// ════════════════════════════════════════════════
// PANEL
// ════════════════════════════════════════════════

function openPanel(key, sx, sy) {
  const data = panels[key];
  if (!data) return;
  panelOpen = key;

  const p = document.getElementById('scroll-panel');
  document.getElementById('p-title').textContent = data.title;
  document.getElementById('p-body').innerHTML = data.html;

  // Position
  let px = sx + 70;
  let py = sy - 60;
  if (px + 420 > W) px = sx - 440;
  if (px < 16) px = 16;
  if (py + 350 > H) py = H - 360;
  if (py < 16) py = 16;

  p.style.left = px + 'px';
  p.style.top = py + 'px';

  // Force reflow then animate
  p.classList.remove('open');
  void p.offsetWidth;
  p.classList.add('open');
}

function closePanel() {
  panelOpen = null;
  document.getElementById('scroll-panel').classList.remove('open');
}

// ════════════════════════════════════════════════
// RESET
// ════════════════════════════════════════════════

function resetGarden() {
  grid.fill(1);
  revealed.clear();
  document.querySelectorAll('.stone-shape').forEach(s => s.classList.remove('revealed'));
  document.querySelectorAll('.moss').forEach(m => m.classList.remove('show'));
  document.getElementById('count').textContent = '0';
  document.getElementById('btn-reset').classList.remove('show');
  closePanel();

  // Redraw
  fxCtx.clearRect(0, 0, W, H);
  buildSandTexture();
  drawSandFull();
}

// ════════════════════════════════════════════════
// AUDIO
// ════════════════════════════════════════════════

function toggleSound() {
  const btn = document.getElementById('btn-sound');

  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    createAmbient();
    audioPlaying = true;
    btn.classList.add('active');
    return;
  }

  if (audioPlaying) {
    audioCtx.suspend();
    audioPlaying = false;
    btn.classList.remove('active');
  } else {
    audioCtx.resume();
    audioPlaying = true;
    btn.classList.add('active');
  }
}

function createAmbient() {
  const master = audioCtx.createGain();
  master.gain.value = 0.6;
  master.connect(audioCtx.destination);

  // Pads: gentle sine drones in a pentatonic
  const freqs = [110, 146.83, 164.81, 220, 293.66];
  freqs.forEach((f, i) => {
    const osc = audioCtx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = f;

    const g = audioCtx.createGain();
    g.gain.value = 0.012 + Math.random() * 0.008;

    const filt = audioCtx.createBiquadFilter();
    filt.type = 'lowpass';
    filt.frequency.value = 300 + i * 50;

    // LFO for movement
    const lfo = audioCtx.createOscillator();
    lfo.frequency.value = 0.05 + Math.random() * 0.15;
    const lfoG = audioCtx.createGain();
    lfoG.gain.value = f * 0.005;
    lfo.connect(lfoG);
    lfoG.connect(osc.frequency);
    lfo.start();

    // Volume LFO for breathing
    const vLfo = audioCtx.createOscillator();
    vLfo.frequency.value = 0.03 + Math.random() * 0.07;
    const vLfoG = audioCtx.createGain();
    vLfoG.gain.value = 0.005;
    vLfo.connect(vLfoG);
    vLfoG.connect(g.gain);
    vLfo.start();

    osc.connect(filt);
    filt.connect(g);
    g.connect(master);
    osc.start();
  });

  // Water noise
  const bufLen = audioCtx.sampleRate * 3;
  const buf = audioCtx.createBuffer(1, bufLen, audioCtx.sampleRate);
  const ch = buf.getChannelData(0);
  for (let i = 0; i < bufLen; i++) {
    ch[i] = (Math.random() * 2 - 1);
  }

  const noise = audioCtx.createBufferSource();
  noise.buffer = buf;
  noise.loop = true;

  const nFilt = audioCtx.createBiquadFilter();
  nFilt.type = 'bandpass';
  nFilt.frequency.value = 600;
  nFilt.Q.value = 0.4;

  const nFilt2 = audioCtx.createBiquadFilter();
  nFilt2.type = 'lowpass';
  nFilt2.frequency.value = 1200;

  const nGain = audioCtx.createGain();
  nGain.gain.value = 0.015;

  noise.connect(nFilt);
  nFilt.connect(nFilt2);
  nFilt2.connect(nGain);
  nGain.connect(master);
  noise.start();

  // Occasional wind chime
  setInterval(() => {
    if (!audioPlaying) return;
    if (Math.random() > 0.3) return;

    const chimFreq = [523.25, 659.25, 783.99, 1046.50, 1318.51][Math.floor(Math.random() * 5)];
    const osc = audioCtx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = chimFreq;

    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0, audioCtx.currentTime);
    g.gain.linearRampToValueAtTime(0.02, audioCtx.currentTime + 0.05);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2.5);

    osc.connect(g);
    g.connect(master);
    osc.start();
    osc.stop(audioCtx.currentTime + 3);
  }, 4000);
}

// ════════════════════════════════════════════════
// MAIN LOOP
// ════════════════════════════════════════════════

let lastTick = 0;

function tick(t) {
  requestAnimationFrame(tick);

  if (t - lastTick > 16) { // ~60fps cap
    flushDirty();
    checkReveals();
    lastTick = t;
  }
}

// ════════════════════════════════════════════════
// BOOT
// ════════════════════════════════════════════════

window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
