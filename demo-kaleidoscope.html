<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anshull Garg | Kaleidoscope Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #050510;
  --ruby: #CC2936;
  --sapphire: #1E4D8C;
  --emerald: #2D8B46;
  --amethyst: #6B2FA0;
  --topaz: #D4A853;
  --panel-bg: rgba(5, 5, 16, 0.75);
  --panel-border: rgba(255, 255, 255, 0.08);
  --text: #f0f0f5;
  --text-dim: rgba(240, 240, 245, 0.6);
}

html {
  scroll-behavior: smooth;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.15) transparent;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Inter', sans-serif;
  overflow-x: hidden;
  line-height: 1.6;
}

canvas#kaleidoscope {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 0;
}

/* Vignette overlay for depth */
.vignette {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 1;
  pointer-events: none;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(5,5,16,0.6) 80%, rgba(5,5,16,0.95) 100%);
}

/* Content wrapper */
.content {
  position: relative;
  z-index: 2;
}

/* Section styling */
section {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 80px 24px;
}

/* Glass panel */
.panel {
  background: var(--panel-bg);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border: 1px solid var(--panel-border);
  border-radius: 24px;
  padding: 48px;
  max-width: 720px;
  width: 100%;
  opacity: 0;
  transform: translateY(40px) scale(0.96);
  transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
              transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  box-shadow: 0 0 80px rgba(0,0,0,0.4),
              inset 0 1px 0 rgba(255,255,255,0.05);
}

.panel.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* Typography */
h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; font-weight: 600; }

.hero-title {
  font-size: clamp(2.8rem, 7vw, 5.5rem);
  font-weight: 700;
  letter-spacing: -0.03em;
  line-height: 1.05;
  margin-bottom: 8px;
}

.hero-subtitle {
  font-size: clamp(1rem, 2.5vw, 1.35rem);
  font-weight: 300;
  color: var(--text-dim);
  margin-bottom: 32px;
  letter-spacing: 0.02em;
}

.section-label {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  margin-bottom: 20px;
  display: inline-block;
  padding: 6px 16px;
  border-radius: 100px;
  border: 1px solid;
}

.label-ruby { color: var(--ruby); border-color: rgba(204,41,54,0.3); }
.label-sapphire { color: var(--sapphire); border-color: rgba(30,77,140,0.3); }
.label-amethyst { color: var(--amethyst); border-color: rgba(107,47,160,0.3); }
.label-topaz { color: var(--topaz); border-color: rgba(212,168,83,0.3); }
.label-rainbow {
  background: linear-gradient(135deg, rgba(204,41,54,0.15), rgba(107,47,160,0.15));
  border-color: rgba(204,41,54,0.3);
  color: var(--ruby);
}

h2 {
  font-size: clamp(1.8rem, 4vw, 2.6rem);
  letter-spacing: -0.02em;
  margin-bottom: 20px;
  line-height: 1.15;
}

p { color: var(--text-dim); margin-bottom: 16px; font-size: 0.95rem; }

/* Accent colored heading spans */
.accent-ruby { color: var(--ruby); }
.accent-sapphire { color: var(--sapphire); }
.accent-emerald { color: var(--emerald); }
.accent-amethyst { color: var(--amethyst); }
.accent-topaz { color: var(--topaz); }

/* Hero section */
.hero-panel {
  text-align: center;
  max-width: 800px;
  background: rgba(5, 5, 16, 0.6);
}

.hero-role {
  display: inline-block;
  font-family: 'Space Grotesk', sans-serif;
  font-size: 0.8rem;
  font-weight: 500;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--topaz);
  border: 1px solid rgba(212, 168, 83, 0.3);
  padding: 8px 24px;
  border-radius: 100px;
  margin-bottom: 32px;
}

.scroll-hint {
  margin-top: 36px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  color: var(--text-dim);
  font-size: 0.75rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  animation: pulse-hint 2.5s ease-in-out infinite;
}

.scroll-hint svg {
  width: 20px; height: 20px;
  stroke: var(--text-dim);
  animation: bounce-down 2s ease-in-out infinite;
}

@keyframes pulse-hint { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
@keyframes bounce-down { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(6px); } }

/* Project cards */
.projects-grid {
  display: grid;
  gap: 16px;
  margin-top: 24px;
}

.project-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 16px;
  padding: 24px;
  transition: all 0.4s ease;
}

.project-card:hover {
  background: rgba(255,255,255,0.06);
  border-color: rgba(255,255,255,0.12);
  transform: translateY(-2px);
}

.project-card h3 {
  font-size: 1.1rem;
  margin-bottom: 8px;
  color: var(--text);
}

.project-card p { font-size: 0.85rem; margin-bottom: 12px; }

.tech-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.tech-tag {
  font-size: 0.65rem;
  font-weight: 500;
  letter-spacing: 0.05em;
  padding: 4px 10px;
  border-radius: 100px;
  background: rgba(30,77,140,0.15);
  color: rgba(100,170,255,0.8);
  border: 1px solid rgba(30,77,140,0.2);
}

/* Skills */
.skills-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 24px;
}

.skill-group h3 {
  font-size: 0.8rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 12px;
  color: var(--amethyst);
}

.skill-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.skill-list li {
  font-size: 0.85rem;
  color: var(--text-dim);
  padding-left: 16px;
  position: relative;
}

.skill-list li::before {
  content: '';
  position: absolute;
  left: 0; top: 50%;
  width: 6px; height: 6px;
  border-radius: 50%;
  transform: translateY(-50%);
  background: var(--amethyst);
  opacity: 0.5;
}

/* Experience */
.timeline { margin-top: 24px; }

.timeline-item {
  position: relative;
  padding-left: 28px;
  padding-bottom: 32px;
  border-left: 1px solid rgba(212,168,83,0.2);
}

.timeline-item:last-child { padding-bottom: 0; border-left-color: transparent; }

.timeline-item::before {
  content: '';
  position: absolute;
  left: -5px; top: 4px;
  width: 9px; height: 9px;
  border-radius: 50%;
  background: var(--topaz);
  box-shadow: 0 0 12px rgba(212,168,83,0.4);
}

.timeline-item h3 {
  font-size: 1.05rem;
  margin-bottom: 2px;
  color: var(--text);
}

.timeline-item .company {
  font-size: 0.85rem;
  color: var(--topaz);
  font-weight: 500;
  margin-bottom: 4px;
}

.timeline-item .dates {
  font-size: 0.75rem;
  color: var(--text-dim);
  margin-bottom: 8px;
}

.timeline-item p { font-size: 0.85rem; }

/* Contact */
.contact-links {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 24px;
}

.contact-link {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 20px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 14px;
  color: var(--text);
  text-decoration: none;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.contact-link:hover {
  background: rgba(255,255,255,0.07);
  border-color: rgba(255,255,255,0.15);
  transform: translateX(4px);
}

.contact-link svg {
  width: 20px; height: 20px;
  flex-shrink: 0;
  opacity: 0.6;
}

/* Navigation dots */
.nav-dots {
  position: fixed;
  right: 24px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.nav-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  border: 1.5px solid rgba(255,255,255,0.25);
  background: transparent;
  cursor: pointer;
  transition: all 0.4s ease;
  position: relative;
}

.nav-dot.active {
  background: rgba(255,255,255,0.8);
  border-color: rgba(255,255,255,0.9);
  box-shadow: 0 0 12px rgba(255,255,255,0.3);
}

.nav-dot::after {
  content: attr(data-label);
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.65rem;
  font-family: 'Space Grotesk', sans-serif;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  white-space: nowrap;
  color: rgba(255,255,255,0.5);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.nav-dot:hover::after { opacity: 1; }

/* Responsive */
@media (max-width: 768px) {
  .panel { padding: 32px 24px; border-radius: 18px; }
  .nav-dots { right: 12px; gap: 10px; }
  .nav-dot { width: 8px; height: 8px; }
  .skills-grid { grid-template-columns: 1fr; }
  section { padding: 60px 16px; }
}

@media (max-width: 480px) {
  .panel { padding: 24px 18px; }
}
</style>
</head>
<body>

<canvas id="kaleidoscope"></canvas>
<div class="vignette"></div>

<!-- Navigation Dots -->
<nav class="nav-dots" aria-label="Section navigation">
  <button class="nav-dot active" data-section="0" data-label="Home" aria-label="Navigate to Home"></button>
  <button class="nav-dot" data-section="1" data-label="About" aria-label="Navigate to About"></button>
  <button class="nav-dot" data-section="2" data-label="Projects" aria-label="Navigate to Projects"></button>
  <button class="nav-dot" data-section="3" data-label="Skills" aria-label="Navigate to Skills"></button>
  <button class="nav-dot" data-section="4" data-label="Experience" aria-label="Navigate to Experience"></button>
  <button class="nav-dot" data-section="5" data-label="Contact" aria-label="Navigate to Contact"></button>
</nav>

<!-- Content -->
<div class="content">

  <!-- Hero -->
  <section id="sec-hero" data-palette="hero">
    <div class="panel hero-panel">
      <div class="hero-role">Software Developer at Walmart</div>
      <h1 class="hero-title">Anshull<br>Garg</h1>
      <p class="hero-subtitle">Building elegant systems through the lens of precision, creativity, and thoughtful engineering.</p>
      <div class="scroll-hint">
        <span>Turn the kaleidoscope</span>
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 5v14M19 12l-7 7-7-7"/>
        </svg>
      </div>
    </div>
  </section>

  <!-- About -->
  <section id="sec-about" data-palette="about">
    <div class="panel">
      <span class="section-label label-ruby">About</span>
      <h2>Crafting <span class="accent-ruby">digital experiences</span> with purpose</h2>
      <p>I am a Software Developer at Walmart, where I work on large-scale systems that serve millions of users. My approach combines a deep understanding of system architecture with an eye for clean, maintainable code.</p>
      <p>With a passion for both frontend elegance and backend robustness, I build solutions that balance performance with developer experience. Every line of code is an opportunity to create something meaningful.</p>
      <p>When I am not coding, you will find me exploring new technologies, contributing to open-source projects, and continuously refining my craft through deliberate practice.</p>
    </div>
  </section>

  <!-- Projects -->
  <section id="sec-projects" data-palette="projects">
    <div class="panel">
      <span class="section-label label-sapphire">Projects</span>
      <h2>Systems built with <span class="accent-sapphire">precision</span></h2>
      <p>A selection of projects that demonstrate architectural thinking and attention to detail.</p>
      <div class="projects-grid">
        <div class="project-card">
          <h3>Inventory Orchestration Platform</h3>
          <p>Real-time inventory management system handling millions of SKU updates per minute across distributed warehouses with sub-second consistency guarantees.</p>
          <div class="tech-tags">
            <span class="tech-tag">Java</span>
            <span class="tech-tag">Kafka</span>
            <span class="tech-tag">Redis</span>
            <span class="tech-tag">Kubernetes</span>
          </div>
        </div>
        <div class="project-card">
          <h3>Smart Search Interface</h3>
          <p>AI-enhanced product search experience with semantic understanding, auto-suggestions, and personalized ranking algorithms for improved conversion rates.</p>
          <div class="tech-tags">
            <span class="tech-tag">React</span>
            <span class="tech-tag">TypeScript</span>
            <span class="tech-tag">Elasticsearch</span>
            <span class="tech-tag">Python</span>
          </div>
        </div>
        <div class="project-card">
          <h3>Performance Analytics Dashboard</h3>
          <p>Internal tooling for monitoring application health, tracking key metrics, and providing actionable insights with real-time data visualization.</p>
          <div class="tech-tags">
            <span class="tech-tag">Next.js</span>
            <span class="tech-tag">D3.js</span>
            <span class="tech-tag">GraphQL</span>
            <span class="tech-tag">PostgreSQL</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Skills -->
  <section id="sec-skills" data-palette="skills">
    <div class="panel">
      <span class="section-label label-amethyst">Skills</span>
      <h2>A <span class="accent-amethyst">multifaceted</span> toolkit</h2>
      <p>Technologies and practices refined through real-world application at scale.</p>
      <div class="skills-grid">
        <div class="skill-group">
          <h3>Languages</h3>
          <ul class="skill-list">
            <li>JavaScript / TypeScript</li>
            <li>Java</li>
            <li>Python</li>
            <li>SQL</li>
            <li>Go</li>
          </ul>
        </div>
        <div class="skill-group">
          <h3>Frontend</h3>
          <ul class="skill-list">
            <li>React / Next.js</li>
            <li>Redux / Zustand</li>
            <li>Tailwind CSS</li>
            <li>Webpack / Vite</li>
            <li>Testing Library</li>
          </ul>
        </div>
        <div class="skill-group">
          <h3>Backend & Infra</h3>
          <ul class="skill-list">
            <li>Node.js / Express</li>
            <li>Spring Boot</li>
            <li>Kafka / RabbitMQ</li>
            <li>Docker / K8s</li>
            <li>AWS / GCP</li>
          </ul>
        </div>
        <div class="skill-group">
          <h3>Practices</h3>
          <ul class="skill-list">
            <li>System Design</li>
            <li>CI/CD Pipelines</li>
            <li>Microservices</li>
            <li>Performance Tuning</li>
            <li>Agile / Scrum</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Experience -->
  <section id="sec-experience" data-palette="experience">
    <div class="panel">
      <span class="section-label label-topaz">Experience</span>
      <h2>A journey of <span class="accent-topaz">growth</span></h2>
      <div class="timeline">
        <div class="timeline-item">
          <h3>Software Developer</h3>
          <div class="company">Walmart Global Tech</div>
          <div class="dates">2022 - Present</div>
          <p>Building and scaling high-traffic e-commerce systems. Working across the stack to deliver features impacting millions of customers, with a focus on performance optimization and system reliability.</p>
        </div>
        <div class="timeline-item">
          <h3>Software Engineering Intern</h3>
          <div class="company">Walmart Global Tech</div>
          <div class="dates">2021 - 2022</div>
          <p>Developed internal tooling and contributed to core platform services. Gained hands-on experience with enterprise-scale distributed systems and agile development workflows.</p>
        </div>
        <div class="timeline-item">
          <h3>Freelance Developer</h3>
          <div class="company">Independent</div>
          <div class="dates">2019 - 2021</div>
          <p>Built full-stack web applications for startups and small businesses. Developed a strong foundation in React, Node.js, and cloud deployment strategies.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section id="sec-contact" data-palette="contact">
    <div class="panel">
      <span class="section-label label-rainbow">Contact</span>
      <h2>Let us <span class="accent-ruby">connect</span></h2>
      <p>Open to conversations about engineering challenges, collaboration opportunities, or just a good chat about technology.</p>
      <div class="contact-links">
        <a href="mailto:anshull.garg@gmail.com" class="contact-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
          </svg>
          anshull.garg@gmail.com
        </a>
        <a href="https://linkedin.com/in/anshullgarg" target="_blank" rel="noopener" class="contact-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/>
          </svg>
          LinkedIn
        </a>
        <a href="https://github.com/anshullgarg" target="_blank" rel="noopener" class="contact-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/>
            <path d="M9 18c-4.51 2-5-2-7-2"/>
          </svg>
          GitHub
        </a>
      </div>
    </div>
  </section>

</div>

<script>
// =====================================================
// KALEIDOSCOPE ENGINE
// =====================================================
const canvas = document.getElementById('kaleidoscope');
const ctx = canvas.getContext('2d');

let W, H, cx, cy, radius;
let mouseX = 0.5, mouseY = 0.5;
let time = 0;
let currentSection = 0;
let targetSection = 0;
let sectionBlend = 0;

// Color palettes per section
const palettes = {
  hero: [
    [204, 41, 54],   // ruby
    [212, 168, 83],  // topaz
    [107, 47, 160],  // amethyst
    [30, 77, 140],   // sapphire
    [45, 139, 70],   // emerald
  ],
  about: [
    [204, 41, 54],   // ruby
    [212, 168, 83],  // topaz
    [180, 60, 40],   // warm orange-red
    [220, 100, 60],  // coral
    [160, 40, 30],   // dark ruby
  ],
  projects: [
    [30, 77, 140],   // sapphire
    [45, 139, 70],   // emerald
    [20, 100, 160],  // bright blue
    [40, 160, 100],  // bright green
    [15, 60, 110],   // deep blue
  ],
  skills: [
    [107, 47, 160],  // amethyst
    [160, 50, 180],  // magenta
    [80, 30, 130],   // deep purple
    [140, 60, 200],  // bright violet
    [204, 41, 54],   // ruby accent
  ],
  experience: [
    [212, 168, 83],  // topaz
    [180, 130, 50],  // dark gold
    [230, 190, 100], // bright gold
    [160, 100, 30],  // amber
    [204, 41, 54],   // ruby accent
  ],
  contact: [
    [204, 41, 54],   // ruby
    [30, 77, 140],   // sapphire
    [45, 139, 70],   // emerald
    [107, 47, 160],  // amethyst
    [212, 168, 83],  // topaz
  ],
};

const paletteKeys = ['hero', 'about', 'projects', 'skills', 'experience', 'contact'];

function resize() {
  const dpr = Math.min(window.devicePixelRatio || 1, 2);
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  cx = W / 2;
  cy = H / 2;
  radius = Math.max(W, H) * 0.75;
}

window.addEventListener('resize', resize);
resize();

// Mouse tracking
document.addEventListener('mousemove', (e) => {
  mouseX = e.clientX / W;
  mouseY = e.clientY / H;
});

// Touch tracking
document.addEventListener('touchmove', (e) => {
  if (e.touches.length > 0) {
    mouseX = e.touches[0].clientX / W;
    mouseY = e.touches[0].clientY / H;
  }
}, { passive: true });

// Lerp color
function lerpColor(a, b, t) {
  return [
    a[0] + (b[0] - a[0]) * t,
    a[1] + (b[1] - a[1]) * t,
    a[2] + (b[2] - a[2]) * t,
  ];
}

function getBlendedPalette() {
  const fromKey = paletteKeys[Math.floor(sectionBlend)];
  const toIdx = Math.min(Math.ceil(sectionBlend), paletteKeys.length - 1);
  const toKey = paletteKeys[toIdx];
  const t = sectionBlend - Math.floor(sectionBlend);
  const from = palettes[fromKey];
  const to = palettes[toKey];
  return from.map((c, i) => lerpColor(c, to[i], t));
}

function colorStr(rgb, alpha = 1) {
  return `rgba(${Math.round(rgb[0])},${Math.round(rgb[1])},${Math.round(rgb[2])},${alpha})`;
}

// Kaleidoscope segment count (symmetry axes)
const SEGMENTS = 8;
const SEGMENT_ANGLE = (Math.PI * 2) / SEGMENTS;

// Draw a single triangle segment of the kaleidoscope pattern
function drawSegmentPattern(palette, t, mx, my) {
  const segCanvas = document.createElement('canvas');
  const segCtx = segCanvas.getContext('2d');
  const segSize = Math.ceil(radius * 1.2);
  segCanvas.width = segSize;
  segCanvas.height = segSize;

  // Organic shapes influenced by mouse and time
  const complexity = 3 + Math.floor(mx * 4);
  const drift = my * 0.4;

  for (let layer = 0; layer < 5; layer++) {
    const col = palette[layer % palette.length];
    const alpha = 0.15 + layer * 0.08;

    for (let i = 0; i < complexity; i++) {
      const phase = t * (0.3 + layer * 0.15) + i * 1.8 + layer * 0.7;
      const px = segSize * 0.2 + Math.sin(phase + drift) * segSize * (0.15 + mx * 0.15);
      const py = segSize * 0.1 + Math.cos(phase * 0.7 + drift) * segSize * (0.1 + my * 0.15) + i * segSize * 0.15;
      const r = segSize * (0.04 + 0.08 * Math.sin(phase * 0.5) + layer * 0.02);

      segCtx.beginPath();

      // Alternate between shape types
      const shapeType = (layer + i) % 4;
      if (shapeType === 0) {
        // Circle
        segCtx.arc(px, py, r, 0, Math.PI * 2);
      } else if (shapeType === 1) {
        // Diamond
        segCtx.moveTo(px, py - r);
        segCtx.lineTo(px + r * 0.7, py);
        segCtx.lineTo(px, py + r);
        segCtx.lineTo(px - r * 0.7, py);
        segCtx.closePath();
      } else if (shapeType === 2) {
        // Triangle
        for (let v = 0; v < 3; v++) {
          const angle = (v / 3) * Math.PI * 2 - Math.PI / 2 + phase * 0.1;
          const vx = px + Math.cos(angle) * r;
          const vy = py + Math.sin(angle) * r;
          v === 0 ? segCtx.moveTo(vx, vy) : segCtx.lineTo(vx, vy);
        }
        segCtx.closePath();
      } else {
        // Elongated ellipse
        segCtx.ellipse(px, py, r * 1.4, r * 0.5, phase * 0.3, 0, Math.PI * 2);
      }

      segCtx.fillStyle = colorStr(col, alpha);
      segCtx.fill();
    }
  }

  // Add some lines for crystalline structure
  for (let i = 0; i < 4; i++) {
    const col = palette[(i + 2) % palette.length];
    const phase = t * 0.2 + i * 1.2;
    const x1 = Math.sin(phase) * segSize * 0.3 + segSize * 0.2;
    const y1 = Math.cos(phase * 0.6) * segSize * 0.15;
    const x2 = Math.sin(phase + 1) * segSize * 0.35 + segSize * 0.3;
    const y2 = segSize * 0.4 + Math.cos(phase * 0.8) * segSize * 0.2;

    segCtx.beginPath();
    segCtx.moveTo(x1, y1);
    segCtx.quadraticCurveTo(
      segSize * 0.3 + Math.sin(phase * 1.3) * segSize * 0.1,
      segSize * 0.2 + Math.cos(phase * 0.9) * segSize * 0.1,
      x2, y2
    );
    segCtx.strokeStyle = colorStr(col, 0.12);
    segCtx.lineWidth = 1.5 + Math.sin(phase) * 1;
    segCtx.stroke();
  }

  return segCanvas;
}

// Main render: mirror segments into kaleidoscope
function renderKaleidoscope(t) {
  ctx.clearRect(0, 0, W, H);

  // Background gradient
  const palette = getBlendedPalette();
  const bgGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius);
  bgGrad.addColorStop(0, colorStr(palette[0], 0.06));
  bgGrad.addColorStop(0.5, 'rgba(5,5,16,0.3)');
  bgGrad.addColorStop(1, 'rgba(5,5,16,1)');
  ctx.fillStyle = bgGrad;
  ctx.fillRect(0, 0, W, H);

  // Generate segment pattern
  const segPattern = drawSegmentPattern(palette, t, mouseX, mouseY);

  // Slow rotation
  const baseRotation = t * 0.08;
  // Pulse effect
  const pulse = 1 + Math.sin(t * 1.2) * 0.008;

  ctx.save();
  ctx.translate(cx, cy);
  ctx.scale(pulse, pulse);

  // Draw each mirrored segment
  for (let i = 0; i < SEGMENTS; i++) {
    ctx.save();
    ctx.rotate(baseRotation + i * SEGMENT_ANGLE);

    // Clip to triangular segment
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(radius * 1.5, 0);
    ctx.arc(0, 0, radius * 1.5, 0, SEGMENT_ANGLE);
    ctx.closePath();
    ctx.clip();

    // Mirror every other segment for reflection effect
    if (i % 2 === 1) {
      ctx.rotate(SEGMENT_ANGLE);
      ctx.scale(1, -1);
    }

    ctx.drawImage(segPattern, 0, -segPattern.height * 0.3);
    ctx.restore();
  }

  ctx.restore();

  // Center glow
  const centerGlow = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius * 0.25);
  centerGlow.addColorStop(0, colorStr(palette[0], 0.08));
  centerGlow.addColorStop(0.5, colorStr(palette[1], 0.03));
  centerGlow.addColorStop(1, 'transparent');
  ctx.fillStyle = centerGlow;
  ctx.fillRect(0, 0, W, H);

  // Outer ring highlight
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(baseRotation * -0.5);
  for (let i = 0; i < SEGMENTS * 2; i++) {
    const angle = (i / (SEGMENTS * 2)) * Math.PI * 2;
    const col = palette[i % palette.length];
    const dist = radius * 0.55 + Math.sin(t * 0.5 + i * 0.8) * radius * 0.05;
    const size = 3 + Math.sin(t * 0.8 + i) * 2;
    ctx.beginPath();
    ctx.arc(Math.cos(angle) * dist, Math.sin(angle) * dist, size, 0, Math.PI * 2);
    ctx.fillStyle = colorStr(col, 0.15 + Math.sin(t + i) * 0.05);
    ctx.fill();
  }
  ctx.restore();

  // Inner geometric ring
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(baseRotation * 0.3);
  ctx.beginPath();
  const innerR = radius * 0.2;
  for (let i = 0; i <= SEGMENTS; i++) {
    const angle = (i / SEGMENTS) * Math.PI * 2;
    const r = innerR + Math.sin(t * 0.6 + i * 1.5) * innerR * 0.15;
    const x = Math.cos(angle) * r;
    const y = Math.sin(angle) * r;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  }
  ctx.closePath();
  ctx.strokeStyle = colorStr(palette[2], 0.08);
  ctx.lineWidth = 1;
  ctx.stroke();
  ctx.restore();
}

// =====================================================
// SCROLL AND INTERSECTION LOGIC
// =====================================================
const sections = document.querySelectorAll('section');
const panels = document.querySelectorAll('.panel');
const navDots = document.querySelectorAll('.nav-dot');

// Intersection observer for panel reveal
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
    }
  });
}, { threshold: 0.15, rootMargin: '-40px' });

panels.forEach(panel => observer.observe(panel));

// Track active section
function updateActiveSection() {
  const scrollY = window.scrollY;
  const viewH = window.innerHeight;

  let active = 0;
  let minDist = Infinity;
  sections.forEach((sec, i) => {
    const rect = sec.getBoundingClientRect();
    const center = rect.top + rect.height / 2;
    const dist = Math.abs(center - viewH / 2);
    if (dist < minDist) {
      minDist = dist;
      active = i;
    }
  });

  targetSection = active;

  // Update nav dots
  navDots.forEach((dot, i) => {
    dot.classList.toggle('active', i === active);
  });
}

window.addEventListener('scroll', updateActiveSection, { passive: true });

// Nav dot click
navDots.forEach(dot => {
  dot.addEventListener('click', () => {
    const idx = parseInt(dot.dataset.section);
    sections[idx].scrollIntoView({ behavior: 'smooth' });
  });
});

// =====================================================
// ANIMATION LOOP
// =====================================================
let lastTime = 0;

function animate(timestamp) {
  const dt = Math.min((timestamp - lastTime) / 1000, 0.05);
  lastTime = timestamp;
  time += dt;

  // Smooth section blend
  const blendSpeed = 2.5;
  if (Math.abs(sectionBlend - targetSection) > 0.01) {
    sectionBlend += (targetSection - sectionBlend) * blendSpeed * dt;
  } else {
    sectionBlend = targetSection;
  }

  renderKaleidoscope(time);
  requestAnimationFrame(animate);
}

requestAnimationFrame(animate);

// Initial reveal
window.addEventListener('load', () => {
  setTimeout(() => {
    document.querySelector('.hero-panel').classList.add('visible');
  }, 300);
});
</script>
</body>
</html>
