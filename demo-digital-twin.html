<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anshull Garg - The Digital Twin</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* ========================================
   RESET & VARIABLES
   ======================================== */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --bg-deep: #0A0A1A;
  --bg-mid: #1A1030;
  --purple: #7C3AED;
  --purple-glow: rgba(124, 58, 237, 0.35);
  --purple-dim: rgba(124, 58, 237, 0.12);
  --copper: #C87941;
  --copper-glow: rgba(200, 121, 65, 0.3);
  --copper-dim: rgba(200, 121, 65, 0.1);
  --text: #F0F0F0;
  --text-secondary: #A0A0B8;
  --text-muted: #6A6A80;
  --card-bg: rgba(20, 16, 36, 0.8);
  --card-border: rgba(124, 58, 237, 0.15);
  --input-bg: rgba(16, 12, 30, 0.9);
  --input-border: rgba(124, 58, 237, 0.25);
  --font-display: 'Space Grotesk', sans-serif;
  --font-body: 'Inter', sans-serif;
}

html {
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: var(--font-body);
  background: linear-gradient(170deg, var(--bg-deep) 0%, var(--bg-mid) 100%);
  color: var(--text);
  height: 100vh;
  height: 100dvh;
  overflow: hidden;
  position: relative;
  cursor: default;
}

/* ========================================
   PARTICLE CANVAS (Background)
   ======================================== */
#particleCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* ========================================
   MAIN LAYOUT
   ======================================== */
.app {
  position: relative;
  z-index: 1;
  height: 100vh;
  height: 100dvh;
  display: flex;
  flex-direction: column;
}

/* ========================================
   HEADER
   ======================================== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 28px;
  flex-shrink: 0;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-logo {
  width: 10px;
  height: 10px;
  background: var(--purple);
  border-radius: 50%;
  box-shadow: 0 0 12px var(--purple-glow);
  animation: logoPulse 2s ease-in-out infinite;
}

@keyframes logoPulse {
  0%, 100% { box-shadow: 0 0 12px var(--purple-glow); }
  50% { box-shadow: 0 0 20px var(--purple-glow), 0 0 40px var(--purple-dim); }
}

.header-name {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 0.95rem;
  letter-spacing: 0.02em;
}

.header-tag {
  font-size: 0.7rem;
  color: var(--text-muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-left: 4px;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.voice-btn {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  color: var(--text);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  font-size: 1rem;
}

.voice-btn:hover {
  border-color: var(--purple);
  box-shadow: 0 0 12px var(--purple-dim);
}

.voice-btn.muted {
  opacity: 0.5;
}

.speed-control {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 20px;
  padding: 4px 12px;
  height: 36px;
}

.speed-label {
  font-size: 0.65rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.speed-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 60px;
  height: 3px;
  background: rgba(124, 58, 237, 0.2);
  border-radius: 2px;
  outline: none;
}

.speed-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--purple);
  cursor: pointer;
  box-shadow: 0 0 6px var(--purple-glow);
}

.speed-value {
  font-size: 0.7rem;
  color: var(--copper);
  font-weight: 500;
  min-width: 28px;
  text-align: right;
  font-family: var(--font-display);
}

/* ========================================
   AVATAR AREA (top 60%)
   ======================================== */
.avatar-area {
  flex: 0 0 52%;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

/* Avatar glow background */
.avatar-glow {
  position: absolute;
  width: 340px;
  height: 340px;
  border-radius: 50%;
  background: radial-gradient(circle, var(--purple-glow) 0%, transparent 70%);
  filter: blur(40px);
  transition: all 0.5s ease;
  pointer-events: none;
}

.avatar-glow.speaking {
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(124, 58, 237, 0.5) 0%, transparent 70%);
}

/* The avatar container */
.avatar-container {
  position: relative;
  width: 280px;
  height: 360px;
  animation: avatarBreathe 4s ease-in-out infinite;
}

@keyframes avatarBreathe {
  0%, 100% { transform: scale(1) translateY(0); }
  50% { transform: scale(1.015) translateY(-3px); }
}

.avatar-container.speaking {
  animation: avatarBreathe 3s ease-in-out infinite;
}

/* Head bob */
.avatar-head-group {
  position: relative;
  animation: headBob 6s ease-in-out infinite;
  transform-origin: center bottom;
}

@keyframes headBob {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(0.8deg); }
  75% { transform: rotate(-0.8deg); }
}

/* ---- SVG Avatar Styles ---- */
.avatar-svg {
  width: 280px;
  height: 360px;
  overflow: visible;
}

/* Head circle */
.head-outline {
  fill: rgba(20, 14, 40, 0.9);
  stroke: var(--purple);
  stroke-width: 2;
  filter: drop-shadow(0 0 8px var(--purple-dim));
  transition: all 0.4s ease;
}

.speaking .head-outline {
  filter: drop-shadow(0 0 16px var(--purple-glow));
  stroke-width: 2.5;
}

/* Glasses */
.glasses-frame {
  fill: none;
  stroke: var(--copper);
  stroke-width: 2.2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.glasses-lens {
  fill: rgba(200, 121, 65, 0.06);
  stroke: var(--copper);
  stroke-width: 1.8;
}

.glasses-lens-glow {
  fill: rgba(124, 58, 237, 0.04);
}

/* Eyes */
.eye-outer {
  fill: rgba(240, 240, 240, 0.95);
  transition: all 0.15s ease;
}

.eye-pupil {
  fill: #1a1a2e;
  transition: all 0.08s ease;
}

.eye-iris {
  fill: var(--purple);
  opacity: 0.7;
  transition: all 0.08s ease;
}

.eye-highlight {
  fill: rgba(255, 255, 255, 0.9);
}

/* Eyelids for blinking */
.eyelid {
  fill: rgba(20, 14, 40, 0.95);
  transform-origin: center;
  transform: scaleY(0);
  transition: transform 0.08s ease;
}

.blinking .eyelid {
  transform: scaleY(1);
}

/* Expressions */
.expression-happy .eye-outer {
  ry: 9;
}

.expression-thinking .eye-pupil,
.expression-thinking .eye-iris {
  transform: translateY(-3px);
}

.expression-excited .eye-outer {
  rx: 14;
  ry: 14;
}

/* Eyebrows */
.eyebrow {
  fill: none;
  stroke: var(--text);
  stroke-width: 2.5;
  stroke-linecap: round;
  opacity: 0.6;
  transition: all 0.3s ease;
}

.expression-happy .eyebrow {
  opacity: 0.4;
}

.expression-thinking .eyebrow-left {
  transform: translateY(-4px) rotate(-5deg);
  transform-origin: center;
}

.expression-thinking .eyebrow-right {
  transform: translateY(-6px) rotate(5deg);
  transform-origin: center;
}

.expression-excited .eyebrow {
  transform: translateY(-5px);
  opacity: 0.8;
}

/* Nose */
.nose {
  fill: none;
  stroke: var(--text);
  stroke-width: 1.5;
  stroke-linecap: round;
  opacity: 0.2;
}

/* Mouth */
.mouth-group {
  transition: all 0.3s ease;
}

.mouth-line {
  fill: none;
  stroke: var(--text);
  stroke-width: 2;
  stroke-linecap: round;
  transition: all 0.3s ease;
}

.mouth-open {
  fill: rgba(30, 20, 50, 0.9);
  stroke: var(--text);
  stroke-width: 1.5;
  opacity: 0;
  transition: all 0.08s ease;
}

.speaking .mouth-open {
  animation: mouthFlap 0.18s ease-in-out infinite alternate;
}

@keyframes mouthFlap {
  0% { opacity: 0; ry: 2; }
  100% { opacity: 1; ry: 8; }
}

.expression-happy .mouth-line {
  d: path("M 122 210 Q 140 226 158 210");
  stroke-width: 2.5;
}

/* Sound wave near mouth when speaking */
.sound-wave {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.speaking .sound-wave {
  opacity: 1;
}

.sound-wave-arc {
  fill: none;
  stroke: var(--purple);
  stroke-width: 1.5;
  stroke-linecap: round;
  opacity: 0;
}

.speaking .sound-wave-arc {
  animation: soundWave 0.8s ease-in-out infinite;
}

.speaking .sound-wave-arc:nth-child(2) {
  animation-delay: 0.15s;
}

.speaking .sound-wave-arc:nth-child(3) {
  animation-delay: 0.3s;
}

@keyframes soundWave {
  0% { opacity: 0.8; transform: translateX(0) scale(1); }
  100% { opacity: 0; transform: translateX(10px) scale(1.3); }
}

/* Shoulders / Body */
.body-shape {
  fill: rgba(20, 14, 40, 0.85);
  stroke: var(--purple);
  stroke-width: 1.5;
  filter: drop-shadow(0 0 6px var(--purple-dim));
}

/* Shirt collar line */
.collar-line {
  fill: none;
  stroke: var(--copper);
  stroke-width: 1.5;
  stroke-linecap: round;
  opacity: 0.6;
}

/* Headphones */
.headphone-band {
  fill: none;
  stroke: var(--text-muted);
  stroke-width: 3;
  stroke-linecap: round;
}

.headphone-cup {
  fill: rgba(40, 30, 60, 0.9);
  stroke: var(--copper);
  stroke-width: 2;
  rx: 4;
}

.headphone-cup-inner {
  fill: var(--copper);
  opacity: 0.2;
}

/* Floating particles around avatar */
.avatar-particles {
  position: absolute;
  inset: -60px;
  pointer-events: none;
}

.avatar-particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--purple);
  border-radius: 50%;
  opacity: 0;
  animation: floatParticle 4s ease-in-out infinite;
}

.avatar-particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; animation-duration: 3.5s; }
.avatar-particle:nth-child(2) { left: 85%; top: 30%; animation-delay: 0.8s; animation-duration: 4.2s; }
.avatar-particle:nth-child(3) { left: 5%; top: 60%; animation-delay: 1.5s; animation-duration: 3.8s; }
.avatar-particle:nth-child(4) { left: 90%; top: 65%; animation-delay: 0.3s; animation-duration: 4.5s; }
.avatar-particle:nth-child(5) { left: 20%; top: 85%; animation-delay: 2.0s; animation-duration: 3.2s; }
.avatar-particle:nth-child(6) { left: 75%; top: 15%; animation-delay: 1.2s; animation-duration: 4.0s; }
.avatar-particle:nth-child(7) { left: 50%; top: 5%; animation-delay: 0.5s; animation-duration: 3.6s; }
.avatar-particle:nth-child(8) { left: 30%; top: 90%; animation-delay: 1.8s; animation-duration: 4.3s; }
.avatar-particle:nth-child(9) { left: 65%; top: 80%; animation-delay: 2.5s; animation-duration: 3.4s; }
.avatar-particle:nth-child(10) { left: 40%; top: 10%; animation-delay: 0.7s; animation-duration: 4.1s; }
.avatar-particle:nth-child(11) { left: 15%; top: 45%; animation-delay: 1.0s; animation-duration: 3.9s; }
.avatar-particle:nth-child(12) { left: 80%; top: 50%; animation-delay: 2.2s; animation-duration: 3.3s; }

@keyframes floatParticle {
  0% { opacity: 0; transform: translateY(0) scale(0.5); }
  20% { opacity: 0.7; }
  80% { opacity: 0.7; }
  100% { opacity: 0; transform: translateY(-30px) scale(1.2); }
}

.speaking .avatar-particle {
  animation-duration: 2s !important;
}

/* Speaking indicator */
.speaking-indicator {
  position: absolute;
  bottom: 8%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 18px;
  background: var(--card-bg);
  border: 1px solid var(--purple);
  border-radius: 20px;
  font-size: 0.75rem;
  color: var(--purple);
  font-family: var(--font-display);
  font-weight: 500;
  letter-spacing: 0.05em;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  box-shadow: 0 0 20px var(--purple-dim);
}

.speaking-indicator.visible {
  opacity: 1;
}

.waveform-mini {
  display: flex;
  align-items: center;
  gap: 2px;
  height: 14px;
}

.waveform-mini-bar {
  width: 2px;
  height: 4px;
  background: var(--purple);
  border-radius: 1px;
  animation: waveBar 0.5s ease-in-out infinite alternate;
}

.waveform-mini-bar:nth-child(1) { animation-delay: 0s; }
.waveform-mini-bar:nth-child(2) { animation-delay: 0.1s; }
.waveform-mini-bar:nth-child(3) { animation-delay: 0.2s; }
.waveform-mini-bar:nth-child(4) { animation-delay: 0.15s; }
.waveform-mini-bar:nth-child(5) { animation-delay: 0.05s; }

@keyframes waveBar {
  0% { height: 3px; }
  100% { height: 14px; }
}

/* Thinking dots */
.thinking-dots {
  position: absolute;
  top: 22%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.thinking-dots.visible {
  opacity: 1;
}

.thinking-dot {
  width: 8px;
  height: 8px;
  background: var(--copper);
  border-radius: 50%;
  animation: thinkBounce 1.2s ease-in-out infinite;
}

.thinking-dot:nth-child(2) { animation-delay: 0.15s; }
.thinking-dot:nth-child(3) { animation-delay: 0.3s; }

@keyframes thinkBounce {
  0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
  40% { transform: translateY(-12px); opacity: 1; }
}

/* ========================================
   CONVERSATION AREA (bottom 48%)
   ======================================== */
.conversation-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0 20px 16px;
  min-height: 0;
}

/* Messages container */
.messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
  scrollbar-width: thin;
  scrollbar-color: var(--purple-dim) transparent;
  min-height: 0;
}

.messages::-webkit-scrollbar {
  width: 4px;
}

.messages::-webkit-scrollbar-track {
  background: transparent;
}

.messages::-webkit-scrollbar-thumb {
  background: var(--purple-dim);
  border-radius: 2px;
}

.message {
  max-width: 540px;
  animation: messageIn 0.4s ease-out;
}

@keyframes messageIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

.message.twin {
  align-self: flex-start;
}

.message.user {
  align-self: flex-end;
}

.message-sender {
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 6px;
  font-weight: 500;
}

.message.twin .message-sender {
  color: var(--purple);
}

.message.user .message-sender {
  color: var(--copper);
  text-align: right;
}

.message-bubble {
  padding: 14px 18px;
  border-radius: 16px;
  font-size: 0.88rem;
  line-height: 1.6;
  position: relative;
}

.message.twin .message-bubble {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-top-left-radius: 4px;
}

.message.user .message-bubble {
  background: rgba(200, 121, 65, 0.1);
  border: 1px solid rgba(200, 121, 65, 0.2);
  border-top-right-radius: 4px;
}

/* Project cards inside messages */
.project-cards {
  display: flex;
  gap: 10px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.project-card {
  background: rgba(124, 58, 237, 0.08);
  border: 1px solid rgba(124, 58, 237, 0.2);
  border-radius: 10px;
  padding: 12px 14px;
  flex: 1;
  min-width: 140px;
  max-width: 200px;
}

.project-card-title {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 0.8rem;
  margin-bottom: 4px;
  color: var(--copper);
}

.project-card-desc {
  font-size: 0.72rem;
  color: var(--text-secondary);
  line-height: 1.4;
}

/* Skill visualization */
.skill-bars {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 12px;
}

.skill-bar {
  display: flex;
  align-items: center;
  gap: 10px;
}

.skill-bar-label {
  font-size: 0.72rem;
  color: var(--text-secondary);
  min-width: 80px;
  font-family: var(--font-display);
}

.skill-bar-track {
  flex: 1;
  height: 4px;
  background: rgba(124, 58, 237, 0.1);
  border-radius: 2px;
  overflow: hidden;
}

.skill-bar-fill {
  height: 100%;
  border-radius: 2px;
  background: linear-gradient(90deg, var(--purple), var(--copper));
  transform-origin: left;
  animation: skillFill 1s ease-out forwards;
  transform: scaleX(0);
}

@keyframes skillFill {
  to { transform: scaleX(1); }
}

/* Contact info */
.contact-links {
  display: flex;
  gap: 10px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.contact-link {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: rgba(200, 121, 65, 0.1);
  border: 1px solid rgba(200, 121, 65, 0.2);
  border-radius: 8px;
  font-size: 0.75rem;
  color: var(--copper);
  text-decoration: none;
  font-family: var(--font-display);
  transition: all 0.2s ease;
}

.contact-link:hover {
  background: rgba(200, 121, 65, 0.18);
  border-color: var(--copper);
}

/* Chips */
.chips {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  padding: 8px 0;
  flex-shrink: 0;
}

.chip {
  padding: 8px 16px;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 20px;
  font-size: 0.78rem;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.25s ease;
  font-family: var(--font-body);
  white-space: nowrap;
}

.chip:hover {
  border-color: var(--purple);
  color: var(--text);
  box-shadow: 0 0 12px var(--purple-dim);
  transform: translateY(-1px);
}

/* Input area */
.input-area {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-shrink: 0;
  padding-top: 8px;
}

.input-wrapper {
  flex: 1;
  position: relative;
}

.text-input {
  width: 100%;
  padding: 14px 18px;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  border-radius: 14px;
  color: var(--text);
  font-size: 0.88rem;
  font-family: var(--font-body);
  outline: none;
  transition: all 0.3s ease;
}

.text-input::placeholder {
  color: var(--text-muted);
}

.text-input:focus {
  border-color: var(--purple);
  box-shadow: 0 0 20px var(--purple-dim);
}

.send-btn {
  width: 48px;
  height: 48px;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--purple), #6D28D9);
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.send-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px var(--purple-glow);
}

.send-btn:active {
  transform: scale(0.95);
}

.send-btn svg {
  width: 20px;
  height: 20px;
}

/* ========================================
   RESPONSIVE
   ======================================== */
@media (max-width: 640px) {
  .header {
    padding: 12px 16px;
  }

  .speed-control {
    display: none;
  }

  .avatar-area {
    flex: 0 0 45%;
  }

  .avatar-container {
    width: 200px;
    height: 260px;
  }

  .avatar-svg {
    width: 200px;
    height: 260px;
  }

  .avatar-glow {
    width: 220px;
    height: 220px;
  }

  .conversation-area {
    padding: 0 12px 12px;
  }

  .chips {
    flex-wrap: nowrap;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-bottom: 4px;
  }

  .chips::-webkit-scrollbar { display: none; }

  .message-bubble {
    font-size: 0.82rem;
    padding: 12px 14px;
  }

  .project-cards {
    flex-direction: column;
  }

  .project-card {
    max-width: none;
  }
}

/* ========================================
   TYPING ANIMATION
   ======================================== */
.typing-indicator {
  display: inline-flex;
  gap: 4px;
  padding: 6px 0;
}

.typing-indicator span {
  width: 6px;
  height: 6px;
  background: var(--purple);
  border-radius: 50%;
  animation: typingDot 1s ease-in-out infinite;
}

.typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
.typing-indicator span:nth-child(3) { animation-delay: 0.3s; }

@keyframes typingDot {
  0%, 100% { opacity: 0.3; transform: scale(0.8); }
  50% { opacity: 1; transform: scale(1); }
}

/* ========================================
   TRANSITIONS & UTILITIES
   ======================================== */
.fade-in {
  animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Expression transitions */
.avatar-container {
  transition: filter 0.4s ease;
}

.avatar-container.expression-excited {
  filter: brightness(1.1);
}

/* Scrollbar for messages */
.messages {
  mask-image: linear-gradient(to bottom, transparent 0%, black 4%, black 96%, transparent 100%);
  -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 4%, black 96%, transparent 100%);
}
</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<div class="app">
  <!-- HEADER -->
  <header class="header">
    <div class="header-left">
      <div class="header-logo"></div>
      <span class="header-name">Anshull Garg</span>
      <span class="header-tag">Digital Twin</span>
    </div>
    <div class="header-controls">
      <div class="speed-control">
        <span class="speed-label">Speed</span>
        <input type="range" class="speed-slider" id="speedSlider" min="0.8" max="1.2" step="0.05" value="1.0">
        <span class="speed-value" id="speedValue">1.0x</span>
      </div>
      <button class="voice-btn" id="voiceToggle" title="Toggle voice" aria-label="Toggle voice on or off">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="voiceIcon">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14" id="voiceWave1"></path>
          <path d="M15.54 8.46a5 5 0 0 1 0 7.07" id="voiceWave2"></path>
        </svg>
      </button>
    </div>
  </header>

  <!-- AVATAR AREA -->
  <div class="avatar-area" id="avatarArea">
    <div class="avatar-glow" id="avatarGlow"></div>

    <div class="avatar-container" id="avatarContainer">
      <div class="avatar-head-group">
        <svg class="avatar-svg" viewBox="0 0 280 360" xmlns="http://www.w3.org/2000/svg">
          <!-- Body / Shoulders -->
          <path class="body-shape" d="M 60 280 Q 60 260 100 250 L 140 240 L 180 250 Q 220 260 220 280 L 230 360 L 50 360 Z"/>
          <line class="collar-line" x1="115" y1="248" x2="140" y2="262"/>
          <line class="collar-line" x1="165" y1="248" x2="140" y2="262"/>

          <!-- Neck -->
          <rect x="125" y="225" width="30" height="25" rx="8" fill="rgba(20, 14, 40, 0.85)" stroke="var(--purple)" stroke-width="1"/>

          <!-- Head -->
          <ellipse class="head-outline" cx="140" cy="140" rx="82" ry="92"/>

          <!-- Hair (geometric style) -->
          <path d="M 58 130 Q 58 55 140 48 Q 222 55 222 130 L 222 115 Q 222 50 140 42 Q 58 50 58 115 Z" fill="rgba(30, 24, 50, 0.95)" stroke="var(--purple)" stroke-width="1.2" opacity="0.7"/>
          <path d="M 62 120 Q 70 65 140 55 Q 180 60 200 80" fill="none" stroke="var(--copper)" stroke-width="1" opacity="0.3"/>

          <!-- Headphones -->
          <path class="headphone-band" d="M 55 130 Q 55 60 140 52 Q 225 60 225 130"/>
          <rect class="headphone-cup" x="42" y="118" width="22" height="32" rx="6"/>
          <rect class="headphone-cup-inner" x="47" y="124" width="12" height="20" rx="3"/>
          <rect class="headphone-cup" x="216" y="118" width="22" height="32" rx="6"/>
          <rect class="headphone-cup-inner" x="221" y="124" width="12" height="20" rx="3"/>

          <!-- Glasses -->
          <rect class="glasses-lens" x="94" y="128" width="38" height="30" rx="8"/>
          <rect class="glasses-lens-glow" x="96" y="130" width="34" height="26" rx="6"/>
          <rect class="glasses-lens" x="148" y="128" width="38" height="30" rx="8"/>
          <rect class="glasses-lens-glow" x="150" y="130" width="34" height="26" rx="6"/>
          <line class="glasses-frame" x1="132" y1="143" x2="148" y2="143"/>
          <line class="glasses-frame" x1="94" y1="143" x2="68" y2="138"/>
          <line class="glasses-frame" x1="186" y1="143" x2="212" y2="138"/>

          <!-- Eyebrows -->
          <path class="eyebrow eyebrow-left" d="M 98 122 Q 113 115 128 120"/>
          <path class="eyebrow eyebrow-right" d="M 152 120 Q 167 115 182 122"/>

          <!-- Left Eye -->
          <g class="eye-group eye-left">
            <ellipse class="eye-outer" cx="113" cy="143" rx="12" ry="11"/>
            <circle class="eye-iris" cx="113" cy="143" r="7" id="irisLeft"/>
            <circle class="eye-pupil" cx="113" cy="143" r="4.5" id="pupilLeft"/>
            <circle class="eye-highlight" cx="110" cy="140" r="2"/>
            <ellipse class="eyelid" cx="113" cy="143" rx="13" ry="12" id="eyelidLeft"/>
          </g>

          <!-- Right Eye -->
          <g class="eye-group eye-right">
            <ellipse class="eye-outer" cx="167" cy="143" rx="12" ry="11"/>
            <circle class="eye-iris" cx="167" cy="143" r="7" id="irisRight"/>
            <circle class="eye-pupil" cx="167" cy="143" r="4.5" id="pupilRight"/>
            <circle class="eye-highlight" cx="164" cy="140" r="2"/>
            <ellipse class="eyelid" cx="167" cy="143" rx="13" ry="12" id="eyelidRight"/>
          </g>

          <!-- Nose -->
          <path class="nose" d="M 140 158 Q 136 170 140 175 Q 144 170 140 175"/>

          <!-- Mouth -->
          <g class="mouth-group" id="mouthGroup">
            <path class="mouth-line" id="mouthLine" d="M 122 200 Q 140 210 158 200"/>
            <ellipse class="mouth-open" id="mouthOpen" cx="140" cy="203" rx="14" ry="4"/>
          </g>

          <!-- Sound wave arcs (right side of mouth) -->
          <g class="sound-wave" id="soundWave" transform="translate(170, 198)">
            <path class="sound-wave-arc" d="M 0 0 Q 8 -6 0 -12" />
            <path class="sound-wave-arc" d="M 4 2 Q 16 -6 4 -14" />
            <path class="sound-wave-arc" d="M 8 4 Q 24 -6 8 -16" />
          </g>
        </svg>
      </div>
    </div>

    <!-- Floating particles around avatar -->
    <div class="avatar-particles" id="avatarParticles">
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
      <div class="avatar-particle"></div>
    </div>

    <!-- Thinking dots -->
    <div class="thinking-dots" id="thinkingDots">
      <div class="thinking-dot"></div>
      <div class="thinking-dot"></div>
      <div class="thinking-dot"></div>
    </div>

    <!-- Speaking indicator -->
    <div class="speaking-indicator" id="speakingIndicator">
      <div class="waveform-mini">
        <div class="waveform-mini-bar"></div>
        <div class="waveform-mini-bar"></div>
        <div class="waveform-mini-bar"></div>
        <div class="waveform-mini-bar"></div>
        <div class="waveform-mini-bar"></div>
      </div>
      Speaking...
    </div>
  </div>

  <!-- CONVERSATION AREA -->
  <div class="conversation-area">
    <div class="messages" id="messages"></div>

    <div class="chips" id="chips">
      <button class="chip" data-query="hello">Say hello</button>
      <button class="chip" data-query="about">Who is Anshull?</button>
      <button class="chip" data-query="projects">Show me projects</button>
      <button class="chip" data-query="skills">What skills do you have?</button>
      <button class="chip" data-query="experience">Walmart experience</button>
      <button class="chip" data-query="contact">How to reach you?</button>
      <button class="chip" data-query="fun">Tell me something fun</button>
    </div>

    <div class="input-area">
      <div class="input-wrapper">
        <input type="text" class="text-input" id="textInput" placeholder="Ask the digital twin anything..." autocomplete="off" aria-label="Type your question here">
      </div>
      <button class="send-btn" id="sendBtn" aria-label="Send message">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
/* ========================================
   BACKGROUND PARTICLES
   ======================================== */
(function initBgParticles() {
  const canvas = document.getElementById('particleCanvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  const PARTICLE_COUNT = 50;

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  for (let i = 0; i < PARTICLE_COUNT; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.3,
      vy: (Math.random() - 0.5) * 0.3,
      size: Math.random() * 2 + 0.5,
      opacity: Math.random() * 0.3 + 0.05,
      color: Math.random() > 0.6 ? '124,58,237' : '200,121,65'
    });
  }

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      if (p.x < 0) p.x = canvas.width;
      if (p.x > canvas.width) p.x = 0;
      if (p.y < 0) p.y = canvas.height;
      if (p.y > canvas.height) p.y = 0;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(${p.color},${p.opacity})`;
      ctx.fill();
    });
    requestAnimationFrame(animate);
  }
  animate();
})();

/* ========================================
   STATE
   ======================================== */
const state = {
  isMuted: false,
  speechRate: 1.0,
  isSpeaking: false,
  isThinking: false,
  currentExpression: 'neutral',
  mouseX: window.innerWidth / 2,
  mouseY: window.innerHeight / 2,
  selectedVoice: null
};

/* ========================================
   DOM REFERENCES
   ======================================== */
const els = {
  avatarContainer: document.getElementById('avatarContainer'),
  avatarGlow: document.getElementById('avatarGlow'),
  pupilLeft: document.getElementById('pupilLeft'),
  pupilRight: document.getElementById('pupilRight'),
  irisLeft: document.getElementById('irisLeft'),
  irisRight: document.getElementById('irisRight'),
  eyelidLeft: document.getElementById('eyelidLeft'),
  eyelidRight: document.getElementById('eyelidRight'),
  mouthLine: document.getElementById('mouthLine'),
  mouthOpen: document.getElementById('mouthOpen'),
  mouthGroup: document.getElementById('mouthGroup'),
  soundWave: document.getElementById('soundWave'),
  speakingIndicator: document.getElementById('speakingIndicator'),
  thinkingDots: document.getElementById('thinkingDots'),
  messages: document.getElementById('messages'),
  textInput: document.getElementById('textInput'),
  sendBtn: document.getElementById('sendBtn'),
  chips: document.getElementById('chips'),
  voiceToggle: document.getElementById('voiceToggle'),
  voiceWave1: document.getElementById('voiceWave1'),
  voiceWave2: document.getElementById('voiceWave2'),
  speedSlider: document.getElementById('speedSlider'),
  speedValue: document.getElementById('speedValue'),
  avatarArea: document.getElementById('avatarArea')
};

/* ========================================
   EYE TRACKING
   ======================================== */
document.addEventListener('mousemove', (e) => {
  state.mouseX = e.clientX;
  state.mouseY = e.clientY;
});

document.addEventListener('touchmove', (e) => {
  if (e.touches.length > 0) {
    state.mouseX = e.touches[0].clientX;
    state.mouseY = e.touches[0].clientY;
  }
});

function updateEyes() {
  const svgRect = els.avatarContainer.getBoundingClientRect();
  const svgCenterX = svgRect.left + svgRect.width / 2;
  const svgCenterY = svgRect.top + svgRect.height * 0.4;

  // Scale factor based on SVG viewBox vs actual size
  const scaleX = svgRect.width / 280;
  const scaleY = svgRect.height / 360;

  // Left eye center in page coords
  const leftEyePageX = svgRect.left + 113 * scaleX;
  const leftEyePageY = svgRect.top + 143 * scaleY;

  // Right eye center in page coords
  const rightEyePageX = svgRect.left + 167 * scaleX;
  const rightEyePageY = svgRect.top + 143 * scaleY;

  const maxOffset = 3.5;

  // Left eye
  const dxL = state.mouseX - leftEyePageX;
  const dyL = state.mouseY - leftEyePageY;
  const angleL = Math.atan2(dyL, dxL);
  const distL = Math.min(Math.sqrt(dxL * dxL + dyL * dyL) / 150, 1);
  const offsetLX = Math.cos(angleL) * maxOffset * distL;
  const offsetLY = Math.sin(angleL) * maxOffset * distL;

  els.pupilLeft.setAttribute('cx', 113 + offsetLX);
  els.pupilLeft.setAttribute('cy', 143 + offsetLY);
  els.irisLeft.setAttribute('cx', 113 + offsetLX * 0.7);
  els.irisLeft.setAttribute('cy', 143 + offsetLY * 0.7);

  // Right eye
  const dxR = state.mouseX - rightEyePageX;
  const dyR = state.mouseY - rightEyePageY;
  const angleR = Math.atan2(dyR, dxR);
  const distR = Math.min(Math.sqrt(dxR * dxR + dyR * dyR) / 150, 1);
  const offsetRX = Math.cos(angleR) * maxOffset * distR;
  const offsetRY = Math.sin(angleR) * maxOffset * distR;

  els.pupilRight.setAttribute('cx', 167 + offsetRX);
  els.pupilRight.setAttribute('cy', 143 + offsetRY);
  els.irisRight.setAttribute('cx', 167 + offsetRX * 0.7);
  els.irisRight.setAttribute('cy', 143 + offsetRY * 0.7);

  requestAnimationFrame(updateEyes);
}
updateEyes();

/* ========================================
   BLINKING
   ======================================== */
function blink() {
  els.avatarContainer.classList.add('blinking');
  setTimeout(() => {
    els.avatarContainer.classList.remove('blinking');
  }, 150);

  // Random interval between 2.5s and 5.5s
  const next = 2500 + Math.random() * 3000;
  setTimeout(blink, next);
}
setTimeout(blink, 2000);

/* ========================================
   EXPRESSIONS
   ======================================== */
function setExpression(expr) {
  // Remove old expression
  els.avatarContainer.classList.remove(
    'expression-neutral', 'expression-happy',
    'expression-thinking', 'expression-excited'
  );
  els.avatarContainer.classList.add(`expression-${expr}`);
  state.currentExpression = expr;

  // Mouth shape adjustments
  switch (expr) {
    case 'happy':
      els.mouthLine.setAttribute('d', 'M 122 200 Q 140 218 158 200');
      break;
    case 'thinking':
      els.mouthLine.setAttribute('d', 'M 128 205 Q 140 203 152 205');
      break;
    case 'excited':
      els.mouthLine.setAttribute('d', 'M 118 198 Q 140 220 162 198');
      break;
    default:
      els.mouthLine.setAttribute('d', 'M 122 200 Q 140 210 158 200');
  }
}

/* ========================================
   SPEAKING
   ======================================== */
function setSpeaking(val) {
  state.isSpeaking = val;
  if (val) {
    els.avatarContainer.classList.add('speaking');
    els.avatarGlow.classList.add('speaking');
    els.speakingIndicator.classList.add('visible');
  } else {
    els.avatarContainer.classList.remove('speaking');
    els.avatarGlow.classList.remove('speaking');
    els.speakingIndicator.classList.remove('visible');
  }
}

function setThinking(val) {
  state.isThinking = val;
  if (val) {
    els.thinkingDots.classList.add('visible');
    setExpression('thinking');
  } else {
    els.thinkingDots.classList.remove('visible');
  }
}

/* ========================================
   SPEECH SYNTHESIS
   ======================================== */
const synth = window.speechSynthesis;

function loadVoices() {
  const voices = synth.getVoices();
  if (!voices.length) return;

  // Prefer natural-sounding voices
  const preferred = [
    'Google UK English Male',
    'Daniel',
    'Google US English',
    'Alex',
    'Samantha',
    'Microsoft David',
    'Microsoft Mark',
    'Google UK English Female',
    'Rishi',
    'Tom'
  ];

  for (const name of preferred) {
    const match = voices.find(v => v.name.includes(name));
    if (match) {
      state.selectedVoice = match;
      return;
    }
  }

  // Fallback: first English voice
  const english = voices.find(v => v.lang.startsWith('en'));
  if (english) state.selectedVoice = english;
}

synth.addEventListener('voiceschanged', loadVoices);
loadVoices();

function speak(text) {
  if (state.isMuted || !synth) return Promise.resolve();

  // Cancel any ongoing speech
  synth.cancel();

  return new Promise((resolve) => {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = state.speechRate;
    utterance.pitch = 1.0;
    utterance.volume = 0.9;

    if (state.selectedVoice) {
      utterance.voice = state.selectedVoice;
    }

    utterance.onstart = () => setSpeaking(true);
    utterance.onend = () => { setSpeaking(false); resolve(); };
    utterance.onerror = () => { setSpeaking(false); resolve(); };

    // Chrome bug workaround: re-trigger if speech pauses
    let resumeTimer;
    utterance.onstart = () => {
      setSpeaking(true);
      resumeTimer = setInterval(() => {
        if (synth.speaking && !synth.paused) return;
        if (synth.paused) synth.resume();
      }, 5000);
    };
    utterance.onend = () => {
      clearInterval(resumeTimer);
      setSpeaking(false);
      resolve();
    };
    utterance.onerror = () => {
      clearInterval(resumeTimer);
      setSpeaking(false);
      resolve();
    };

    synth.speak(utterance);
  });
}

/* ========================================
   VOICE CONTROLS
   ======================================== */
els.voiceToggle.addEventListener('click', () => {
  state.isMuted = !state.isMuted;
  els.voiceToggle.classList.toggle('muted', state.isMuted);
  if (state.isMuted) {
    els.voiceWave1.style.display = 'none';
    els.voiceWave2.style.display = 'none';
    synth.cancel();
    setSpeaking(false);
  } else {
    els.voiceWave1.style.display = '';
    els.voiceWave2.style.display = '';
  }
});

els.speedSlider.addEventListener('input', () => {
  state.speechRate = parseFloat(els.speedSlider.value);
  els.speedValue.textContent = state.speechRate.toFixed(1) + 'x';
});

/* ========================================
   RESPONSES
   ======================================== */
const responses = {
  greeting: {
    text: "Hey there! I'm Anshull's digital twin -- a stylized version of the real deal. I know everything about his work, skills, and projects. Ask me anything, and I'll do my best to fill you in. Go ahead, pick a topic or type your own question!",
    speech: "Hey there! I'm Anshull's digital twin. I know everything about his work, skills, and projects. Ask me anything!",
    expression: 'happy',
    extra: null
  },
  about: {
    text: "Anshull Garg is a Software Engineer at Walmart Global Tech, where he builds scalable, high-performance applications that power enterprise e-commerce at Fortune 1 scale. He's a full-stack developer who obsesses over clean architecture, seamless user experiences, and code that ships. When he's not shipping features for millions of users, he's exploring new technologies and building side projects that push his craft forward.",
    speech: "Anshull Garg is a Software Engineer at Walmart Global Tech, building scalable applications at Fortune 1 scale. He's a full-stack developer who cares deeply about clean architecture and shipping code that matters.",
    expression: 'neutral',
    extra: null
  },
  projects: {
    text: "Here are some highlights from Anshull's project portfolio. Each one represents a different facet of his engineering skills:",
    speech: "Let me show you some of Anshull's projects. Each one showcases different engineering skills, from scalable backends to polished frontend experiences.",
    expression: 'excited',
    extra: 'projects'
  },
  skills: {
    text: "Anshull's technical toolkit spans the full stack. Here's a breakdown of his core competencies:",
    speech: "Anshull works across the full stack. His strongest areas include React and frontend engineering, Node.js backend systems, and cloud infrastructure with a focus on performance.",
    expression: 'neutral',
    extra: 'skills'
  },
  experience: {
    text: "At Walmart Global Tech, Anshull works on systems that serve millions of customers daily. He architects scalable APIs, optimizes frontend performance, and collaborates with cross-functional teams to ship features at enterprise scale. Working at the Fortune number one company means every line of code has to handle massive traffic, edge cases, and the unpredictable reality of production at scale.",
    speech: "At Walmart Global Tech, Anshull builds systems serving millions of customers. He works on scalable APIs, frontend performance, and cross-functional feature delivery at the Fortune number one company.",
    expression: 'happy',
    extra: null
  },
  contact: {
    text: "Want to reach the real Anshull? He's always open to discussing new opportunities, interesting projects, or just talking about technology. Here's how to connect:",
    speech: "Want to reach the real me? Anshull is always open to new opportunities and interesting conversations. You can find him on LinkedIn, GitHub, or drop him an email.",
    expression: 'happy',
    extra: 'contact'
  },
  fun: {
    text: "Here's something you might not know -- this entire digital twin is running in a single HTML file with zero external dependencies (besides fonts). The avatar's eyes are tracking your cursor right now in real-time, the blinking is randomized to feel natural, and everything you hear is generated on-the-fly using the Web Speech Synthesis API. The portfolio itself is a demonstration of what Anshull can build. Pretty meta, right?",
    speech: "Here's something fun. This entire digital twin runs in a single HTML file with zero dependencies. My eyes are tracking your cursor right now, and my voice is generated live using Web Speech Synthesis. The portfolio itself is a demo of Anshull's skills. Pretty meta, right?",
    expression: 'excited',
    extra: null
  },
  philosophy: {
    text: "Anshull believes great software lives at the intersection of clean architecture, deep user empathy, and relentless iteration. His code philosophy: readability is not optional, tests are documentation that executes, and every pull request should leave the codebase better than you found it. He ships first, measures second, and iterates always.",
    speech: "Anshull believes in clean architecture, user empathy, and relentless iteration. Readability is not optional. Tests are documentation. And every PR should leave the codebase better than you found it.",
    expression: 'neutral',
    extra: null
  },
  default: {
    text: "Hmm, I'm not sure I have a specific answer for that one. But I know a lot about Anshull's projects, skills, experience at Walmart, and how to get in touch with him. Try asking about one of those topics, or click one of the suggested questions below!",
    speech: "Hmm, I'm not quite sure about that. Try asking about Anshull's projects, skills, or experience. I know a lot about those!",
    expression: 'thinking',
    extra: null
  }
};

function matchResponse(input) {
  const lower = input.toLowerCase().trim();

  if (/^(hi|hey|hello|howdy|sup|yo|greetings|what'?s up)/.test(lower)) return 'greeting';
  if (/\b(who|about|tell me about|yourself|bio|background|story)\b/.test(lower)) return 'about';
  if (/\b(project|portfolio|built|build|work|show|demo|app)\b/.test(lower)) return 'projects';
  if (/\b(skill|tech|stack|technolog|language|framework|tool|know)\b/.test(lower)) return 'skills';
  if (/\b(experience|walmart|job|career|company|enterprise|role|position)\b/.test(lower)) return 'experience';
  if (/\b(contact|reach|email|connect|hire|linkedin|github|social|message)\b/.test(lower)) return 'contact';
  if (/\b(fun|fact|interesting|secret|cool|surprise|meta|random|joke)\b/.test(lower)) return 'fun';
  if (/\b(philosophy|principle|believe|value|approach|method|style|code review|clean)\b/.test(lower)) return 'philosophy';

  return 'default';
}

/* ========================================
   RENDER EXTRAS
   ======================================== */
function renderExtra(type) {
  if (type === 'projects') {
    return `
      <div class="project-cards">
        <div class="project-card">
          <div class="project-card-title">Enterprise E-Commerce</div>
          <div class="project-card-desc">Scalable retail platform serving millions at Walmart. React, Node.js, microservices.</div>
        </div>
        <div class="project-card">
          <div class="project-card-title">Performance Dashboard</div>
          <div class="project-card-desc">Real-time monitoring and optimization tools for web performance metrics.</div>
        </div>
        <div class="project-card">
          <div class="project-card-title">Design System</div>
          <div class="project-card-desc">Component library with accessibility-first approach. Used across multiple teams.</div>
        </div>
      </div>
    `;
  }

  if (type === 'skills') {
    return `
      <div class="skill-bars">
        <div class="skill-bar">
          <span class="skill-bar-label">React / Next.js</span>
          <div class="skill-bar-track"><div class="skill-bar-fill" style="width:92%"></div></div>
        </div>
        <div class="skill-bar">
          <span class="skill-bar-label">TypeScript</span>
          <div class="skill-bar-track"><div class="skill-bar-fill" style="width:88%"></div></div>
        </div>
        <div class="skill-bar">
          <span class="skill-bar-label">Node.js</span>
          <div class="skill-bar-track"><div class="skill-bar-fill" style="width:85%"></div></div>
        </div>
        <div class="skill-bar">
          <span class="skill-bar-label">Python</span>
          <div class="skill-bar-track"><div class="skill-bar-fill" style="width:78%"></div></div>
        </div>
        <div class="skill-bar">
          <span class="skill-bar-label">Cloud / DevOps</span>
          <div class="skill-bar-track"><div class="skill-bar-fill" style="width:75%"></div></div>
        </div>
        <div class="skill-bar">
          <span class="skill-bar-label">System Design</span>
          <div class="skill-bar-track"><div class="skill-bar-fill" style="width:82%"></div></div>
        </div>
      </div>
    `;
  }

  if (type === 'contact') {
    return `
      <div class="contact-links">
        <a class="contact-link" href="mailto:anshull.garg@gmail.com" target="_blank">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
          Email
        </a>
        <a class="contact-link" href="https://linkedin.com/in/anshullgarg" target="_blank" rel="noopener">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
          LinkedIn
        </a>
        <a class="contact-link" href="https://github.com/anshullgarg" target="_blank" rel="noopener">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
          GitHub
        </a>
      </div>
    `;
  }

  return '';
}

/* ========================================
   MESSAGE HANDLING
   ======================================== */
function addMessage(type, content, extra) {
  const msg = document.createElement('div');
  msg.className = `message ${type}`;

  const sender = type === 'twin' ? 'Digital Twin' : 'You';
  msg.innerHTML = `
    <div class="message-sender">${sender}</div>
    <div class="message-bubble">${content}${extra ? renderExtra(extra) : ''}</div>
  `;

  els.messages.appendChild(msg);
  els.messages.scrollTop = els.messages.scrollHeight;
  return msg;
}

function addTypingIndicator() {
  const msg = document.createElement('div');
  msg.className = 'message twin';
  msg.id = 'typingMsg';
  msg.innerHTML = `
    <div class="message-sender">Digital Twin</div>
    <div class="message-bubble">
      <div class="typing-indicator"><span></span><span></span><span></span></div>
    </div>
  `;
  els.messages.appendChild(msg);
  els.messages.scrollTop = els.messages.scrollHeight;
  return msg;
}

function removeTypingIndicator() {
  const el = document.getElementById('typingMsg');
  if (el) el.remove();
}

async function handleQuery(input) {
  if (!input.trim()) return;
  if (state.isSpeaking || state.isThinking) {
    synth.cancel();
    setSpeaking(false);
  }

  // Add user message
  addMessage('user', input);

  // Show thinking
  setThinking(true);
  const typingMsg = addTypingIndicator();

  // Simulate "thinking" delay
  await new Promise(r => setTimeout(r, 800 + Math.random() * 600));

  setThinking(false);
  removeTypingIndicator();

  // Get response
  const key = matchResponse(input);
  const resp = responses[key];

  // Set expression
  setExpression(resp.expression);

  // Add twin message
  addMessage('twin', resp.text, resp.extra);

  // Speak
  await speak(resp.speech);

  // Return to neutral after a moment
  setTimeout(() => {
    if (!state.isSpeaking) setExpression('neutral');
  }, 1500);
}

/* ========================================
   INPUT HANDLING
   ======================================== */
els.sendBtn.addEventListener('click', () => {
  const val = els.textInput.value.trim();
  if (val) {
    els.textInput.value = '';
    handleQuery(val);
  }
});

els.textInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    const val = els.textInput.value.trim();
    if (val) {
      els.textInput.value = '';
      handleQuery(val);
    }
  }
});

// Chip buttons
els.chips.addEventListener('click', (e) => {
  const chip = e.target.closest('.chip');
  if (!chip) return;
  const query = chip.dataset.query;
  const labelMap = {
    hello: 'Hello!',
    about: 'Who is Anshull?',
    projects: 'Show me your projects',
    skills: 'What skills do you have?',
    experience: 'Tell me about your Walmart experience',
    contact: 'How can I reach you?',
    fun: 'Tell me something fun'
  };
  handleQuery(labelMap[query] || query);
});

/* ========================================
   INITIAL GREETING
   ======================================== */
setTimeout(() => {
  setExpression('happy');
  addMessage('twin', responses.greeting.text);
  speak(responses.greeting.speech).then(() => {
    setTimeout(() => setExpression('neutral'), 1500);
  });
}, 800);

/* ========================================
   KEYBOARD ACCESSIBILITY
   ======================================== */
document.addEventListener('keydown', (e) => {
  // Escape to stop speaking
  if (e.key === 'Escape') {
    synth.cancel();
    setSpeaking(false);
    setExpression('neutral');
  }
  // M to toggle mute
  if (e.key === 'm' && document.activeElement !== els.textInput) {
    els.voiceToggle.click();
  }
});
</script>
</body>
</html>
