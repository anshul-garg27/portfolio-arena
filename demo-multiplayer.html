<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anshull Garg | The Multiplayer Portfolio</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #0F0F14;
  --surface: #1A1A22;
  --border: #2A2A35;
  --text: #EDEDED;
  --text-muted: #8888A0;
  --accent: #3B82F6;
  --accent-glow: rgba(59, 130, 246, 0.15);
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Inter', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  overflow-x: hidden;
  min-height: 100vh;
}

code, .mono { font-family: 'JetBrains Mono', monospace; }

/* ---- SCROLLBAR ---- */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* ---- TOP BAR ---- */
.topbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 32px; height: 56px;
  background: rgba(15, 15, 20, 0.85);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
}

.topbar-left {
  font-weight: 600; font-size: 15px; letter-spacing: -0.3px;
}

.topbar-left span { color: var(--text-muted); font-weight: 400; }

.topbar-center {
  display: flex; align-items: center; gap: 8px;
  font-size: 13px; color: var(--text-muted);
}

.pulse-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: #22C55E; position: relative;
}
.pulse-dot::after {
  content: ''; position: absolute; inset: -3px;
  border-radius: 50%; background: rgba(34, 197, 94, 0.4);
  animation: pulse 2s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.8); opacity: 0; }
}

.btn-note {
  padding: 7px 16px; border-radius: 8px;
  background: var(--accent); color: #fff;
  border: none; font-size: 13px; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  font-family: 'Inter', sans-serif;
}
.btn-note:hover { background: #2563EB; transform: translateY(-1px); }

/* ---- TOAST NOTIFICATIONS ---- */
.toast-container {
  position: fixed; top: 68px; right: 24px; z-index: 200;
  display: flex; flex-direction: column; gap: 8px;
  pointer-events: none;
}

.toast {
  padding: 10px 16px; border-radius: 10px;
  background: var(--surface); border: 1px solid var(--border);
  font-size: 13px; color: var(--text-muted);
  opacity: 0; transform: translateX(40px);
  animation: toastIn 0.4s ease forwards, toastOut 0.4s ease 3s forwards;
  white-space: nowrap;
}
.toast .name { font-weight: 600; color: var(--text); }

@keyframes toastIn {
  to { opacity: 1; transform: translateX(0); }
}
@keyframes toastOut {
  to { opacity: 0; transform: translateX(40px); }
}

/* ---- SIMULATED CURSORS ---- */
.fake-cursor {
  position: fixed; z-index: 150; pointer-events: none;
  transition: opacity 0.5s;
}
.fake-cursor.hidden { opacity: 0; }

.fake-cursor svg { width: 20px; height: 20px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4)); }

.cursor-label {
  position: absolute; left: 20px; top: 16px;
  padding: 3px 8px; border-radius: 6px;
  font-size: 11px; font-weight: 500;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.cursor-message {
  position: absolute; left: 20px; top: 36px;
  padding: 6px 10px; border-radius: 8px;
  background: var(--surface); border: 1px solid var(--border);
  font-size: 12px; color: var(--text);
  max-width: 200px; white-space: nowrap;
  opacity: 0; transition: opacity 0.3s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.cursor-message.visible { opacity: 1; }

/* ---- MAIN CONTENT ---- */
.main { padding-top: 56px; }

/* HERO */
.hero {
  max-width: 800px; margin: 0 auto;
  padding: 100px 32px 80px;
  text-align: center;
}
.hero-tag {
  display: inline-block; padding: 4px 12px;
  border-radius: 20px; font-size: 12px; font-weight: 500;
  background: var(--accent-glow); color: var(--accent);
  border: 1px solid rgba(59, 130, 246, 0.2);
  margin-bottom: 20px; letter-spacing: 0.5px;
  text-transform: uppercase;
}
.hero h1 {
  font-size: clamp(36px, 5vw, 56px);
  font-weight: 700; letter-spacing: -1.5px;
  line-height: 1.1; margin-bottom: 16px;
}
.hero h1 .accent { color: var(--accent); }
.hero p {
  font-size: 18px; color: var(--text-muted);
  max-width: 520px; margin: 0 auto 32px;
  line-height: 1.7;
}
.hero-links { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
.hero-links a {
  padding: 10px 20px; border-radius: 10px;
  font-size: 14px; font-weight: 500; text-decoration: none;
  transition: all 0.2s;
}
.hero-links a.primary {
  background: var(--accent); color: #fff;
}
.hero-links a.primary:hover { background: #2563EB; transform: translateY(-1px); }
.hero-links a.secondary {
  background: var(--surface); color: var(--text);
  border: 1px solid var(--border);
}
.hero-links a.secondary:hover { border-color: var(--accent); }

/* SECTIONS */
.section {
  max-width: 960px; margin: 0 auto;
  padding: 60px 32px;
}
.section-label {
  font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--accent); margin-bottom: 8px;
}
.section h2 {
  font-size: 28px; font-weight: 700;
  letter-spacing: -0.5px; margin-bottom: 24px;
}

/* ABOUT */
.about-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 24px;
}
.about-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 28px;
  transition: border-color 0.3s;
}
.about-card:hover { border-color: rgba(59, 130, 246, 0.3); }
.about-card h3 { font-size: 16px; margin-bottom: 12px; }
.about-card p { font-size: 14px; color: var(--text-muted); line-height: 1.7; }
.about-card .stat { font-size: 32px; font-weight: 700; color: var(--accent); margin-bottom: 4px; }

/* PROJECTS */
.project-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;
}
.project-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 28px;
  transition: all 0.3s; position: relative;
  overflow: hidden;
}
.project-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--accent), #8B5CF6);
  opacity: 0; transition: opacity 0.3s;
}
.project-card:hover { border-color: rgba(59, 130, 246, 0.3); transform: translateY(-2px); }
.project-card:hover::before { opacity: 1; }
.project-card .tag {
  display: inline-block; padding: 3px 8px; border-radius: 6px;
  font-size: 11px; font-weight: 500;
  background: rgba(59, 130, 246, 0.1); color: var(--accent);
  margin-bottom: 12px;
}
.project-card h3 { font-size: 18px; font-weight: 600; margin-bottom: 10px; }
.project-card p { font-size: 13px; color: var(--text-muted); line-height: 1.7; margin-bottom: 16px; }
.project-card .tech {
  display: flex; gap: 6px; flex-wrap: wrap;
}
.project-card .tech span {
  padding: 3px 8px; border-radius: 6px;
  font-size: 11px; font-family: 'JetBrains Mono', monospace;
  background: rgba(255,255,255,0.05); color: var(--text-muted);
}

/* SKILLS */
.skills-tags {
  display: flex; flex-wrap: wrap; gap: 10px;
}
.skill-tag {
  padding: 8px 16px; border-radius: 10px;
  font-size: 13px; font-weight: 500;
  background: var(--surface); border: 1px solid var(--border);
  transition: all 0.2s;
}
.skill-tag:hover { border-color: var(--accent); color: var(--accent); }
.skill-tag.highlight { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

/* CONTACT */
.contact-links {
  display: flex; gap: 12px; flex-wrap: wrap;
}
.contact-link {
  display: flex; align-items: center; gap: 8px;
  padding: 12px 20px; border-radius: 10px;
  background: var(--surface); border: 1px solid var(--border);
  font-size: 14px; color: var(--text); text-decoration: none;
  transition: all 0.2s;
}
.contact-link:hover { border-color: var(--accent); transform: translateY(-1px); }

/* VISITOR COUNTER */
.visitor-section {
  max-width: 960px; margin: 0 auto;
  padding: 40px 32px 20px; text-align: center;
}
.visitor-count {
  font-size: 14px; color: var(--text-muted);
}
.visitor-count strong { color: var(--text); font-weight: 600; }
.popular-section {
  margin-top: 8px; font-size: 12px; color: var(--text-muted);
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.popular-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--accent);
  animation: pulse 1.5s ease-in-out infinite;
}

/* STICKY NOTES */
.sticky-note {
  position: absolute; z-index: 50;
  width: 200px; padding: 14px 16px;
  border-radius: 4px;
  font-size: 13px; line-height: 1.5;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3), 0 1px 3px rgba(0,0,0,0.2);
  cursor: grab; user-select: none;
  transition: box-shadow 0.2s;
}
.sticky-note:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
.sticky-note.dragging { cursor: grabbing; box-shadow: 0 12px 32px rgba(0,0,0,0.5); z-index: 60; }
.sticky-note .note-author {
  font-size: 11px; opacity: 0.6; margin-top: 8px;
  font-style: italic;
}
.sticky-note .note-close {
  position: absolute; top: 4px; right: 8px;
  font-size: 14px; cursor: pointer; opacity: 0.3;
  background: none; border: none; color: inherit;
  line-height: 1;
}
.sticky-note .note-close:hover { opacity: 0.7; }

/* NEW NOTE INPUT */
.note-input-overlay {
  display: none; position: fixed; inset: 0; z-index: 300;
  background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
  align-items: center; justify-content: center;
}
.note-input-overlay.active { display: flex; }
.note-input-box {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 16px; padding: 24px; width: 340px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.5);
}
.note-input-box h3 { font-size: 16px; margin-bottom: 16px; }
.note-input-box textarea {
  width: 100%; height: 80px; resize: none;
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 10px; padding: 12px;
  color: var(--text); font-size: 14px;
  font-family: 'Inter', sans-serif;
  outline: none;
}
.note-input-box textarea:focus { border-color: var(--accent); }
.note-input-box .char-count {
  font-size: 11px; color: var(--text-muted); text-align: right;
  margin-top: 4px;
}
.note-input-actions {
  display: flex; gap: 8px; margin-top: 16px; justify-content: flex-end;
}
.note-input-actions button {
  padding: 8px 16px; border-radius: 8px;
  font-size: 13px; font-weight: 500; cursor: pointer;
  font-family: 'Inter', sans-serif; border: none;
}
.note-input-actions .cancel {
  background: transparent; color: var(--text-muted);
}
.note-input-actions .post {
  background: var(--accent); color: #fff;
}
.note-input-actions .post:hover { background: #2563EB; }

/* EMOJI REACTION BAR */
.reaction-bar {
  position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
  z-index: 100; display: flex; gap: 4px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 16px; padding: 8px 12px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.reaction-btn {
  width: 40px; height: 40px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; cursor: pointer;
  background: transparent; border: none;
  transition: all 0.15s;
}
.reaction-btn:hover { background: rgba(255,255,255,0.08); transform: scale(1.2); }
.reaction-btn:active { transform: scale(0.9); }

/* FLOATING EMOJI */
.floating-emoji {
  position: fixed; z-index: 160; pointer-events: none;
  font-size: 28px;
  animation: floatUp 2s ease-out forwards;
}
@keyframes floatUp {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  50% { opacity: 1; transform: translateY(-60px) scale(1.1); }
  100% { opacity: 0; transform: translateY(-140px) scale(0.8); }
}

/* FOOTER */
.footer {
  text-align: center; padding: 40px 32px 100px;
  font-size: 12px; color: var(--text-muted);
}

/* RESPONSIVE */
@media (max-width: 640px) {
  .topbar { padding: 0 16px; }
  .topbar-center { display: none; }
  .about-grid { grid-template-columns: 1fr; }
  .project-grid { grid-template-columns: 1fr; }
  .hero { padding: 80px 20px 60px; }
  .section { padding: 40px 20px; }
  .reaction-bar { bottom: 16px; }
}

/* HIGHLIGHT EFFECT ON HOVERED ELEMENTS */
.cursor-hovered {
  outline: 2px solid rgba(59, 130, 246, 0.25);
  outline-offset: 4px;
  border-radius: 8px;
  transition: outline-color 0.3s;
}
</style>
</head>
<body>

<!-- TOP BAR -->
<header class="topbar">
  <div class="topbar-left">Anshull Garg <span>| Portfolio</span></div>
  <div class="topbar-center">
    <span class="pulse-dot"></span>
    <span id="onlineCount">3 visitors online</span>
  </div>
  <button class="btn-note" id="btnLeaveNote">Leave a note</button>
</header>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<!-- MAIN CONTENT -->
<div class="main" id="mainContent">

  <!-- VISITOR COUNTER -->
  <div class="visitor-section">
    <div class="visitor-count"><strong id="totalVisitors">12,847</strong> visitors have explored this portfolio</div>
    <div class="popular-section">
      <span class="popular-dot"></span>
      <span id="popularSection">Projects section is popular right now</span>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero" data-hoverable="hero">
    <div class="hero-tag">Software Developer at Walmart</div>
    <h1>Hi, I'm <span class="accent">Anshull Garg</span></h1>
    <p>Building scalable systems and thoughtful interfaces. I care about clean code, performance, and user experiences that just work.</p>
    <div class="hero-links">
      <a href="#projects" class="primary">View Projects</a>
      <a href="#contact" class="secondary">Get in Touch</a>
    </div>
  </section>

  <!-- ABOUT -->
  <section class="section" id="about" data-hoverable="about">
    <div class="section-label">About</div>
    <h2>A bit about me</h2>
    <div class="about-grid">
      <div class="about-card" data-hoverable="about-bio">
        <h3>Background</h3>
        <p>Software Developer at Walmart, working on large-scale distributed systems that serve millions of users. I enjoy the intersection of backend reliability and frontend polish -- systems that are both robust and delightful to use.</p>
      </div>
      <div class="about-card" data-hoverable="about-stats">
        <h3>By the Numbers</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:8px;">
          <div><div class="stat">3+</div><p>Years Experience</p></div>
          <div><div class="stat">50M+</div><p>Users Impacted</p></div>
          <div><div class="stat">200+</div><p>PRs Merged</p></div>
          <div><div class="stat">15+</div><p>Projects Shipped</p></div>
        </div>
      </div>
    </div>
  </section>

  <!-- PROJECTS -->
  <section class="section" id="projects" data-hoverable="projects">
    <div class="section-label">Projects</div>
    <h2>Selected Work</h2>
    <div class="project-grid">
      <div class="project-card" data-hoverable="project-1">
        <span class="tag">Full Stack</span>
        <h3>Inventory Intelligence Platform</h3>
        <p>Real-time inventory tracking and demand forecasting system handling millions of SKUs across thousands of stores. Reduced stockouts by 23%.</p>
        <div class="tech">
          <span>Java</span><span>Kafka</span><span>React</span><span>Redis</span>
        </div>
      </div>
      <div class="project-card" data-hoverable="project-2">
        <span class="tag">Backend</span>
        <h3>Checkout Optimization Engine</h3>
        <p>High-throughput payment processing pipeline with sub-100ms latency. Processes 10k+ transactions per second during peak traffic.</p>
        <div class="tech">
          <span>Go</span><span>gRPC</span><span>PostgreSQL</span><span>K8s</span>
        </div>
      </div>
      <div class="project-card" data-hoverable="project-3">
        <span class="tag">Open Source</span>
        <h3>DevFlow CLI</h3>
        <p>A developer productivity CLI that automates repetitive workflows -- PR creation, environment setup, and deployment pipelines. 2k+ GitHub stars.</p>
        <div class="tech">
          <span>Rust</span><span>GitHub API</span><span>Docker</span>
        </div>
      </div>
    </div>
  </section>

  <!-- SKILLS -->
  <section class="section" id="skills" data-hoverable="skills">
    <div class="section-label">Skills</div>
    <h2>Technologies I work with</h2>
    <div class="skills-tags">
      <span class="skill-tag">JavaScript</span>
      <span class="skill-tag">TypeScript</span>
      <span class="skill-tag highlight">React</span>
      <span class="skill-tag">Node.js</span>
      <span class="skill-tag highlight">Java</span>
      <span class="skill-tag">Go</span>
      <span class="skill-tag">Rust</span>
      <span class="skill-tag">Python</span>
      <span class="skill-tag highlight">Kafka</span>
      <span class="skill-tag">Redis</span>
      <span class="skill-tag">PostgreSQL</span>
      <span class="skill-tag">MongoDB</span>
      <span class="skill-tag highlight">Kubernetes</span>
      <span class="skill-tag">Docker</span>
      <span class="skill-tag">AWS</span>
      <span class="skill-tag">GCP</span>
      <span class="skill-tag">GraphQL</span>
      <span class="skill-tag">gRPC</span>
      <span class="skill-tag">CI/CD</span>
      <span class="skill-tag">Terraform</span>
    </div>
  </section>

  <!-- CONTACT -->
  <section class="section" id="contact" data-hoverable="contact">
    <div class="section-label">Contact</div>
    <h2>Let's connect</h2>
    <div class="contact-links">
      <a href="mailto:anshull.garg@example.com" class="contact-link">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Email
      </a>
      <a href="https://github.com/anshullgarg" class="contact-link" target="_blank">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
        GitHub
      </a>
      <a href="https://linkedin.com/in/anshullgarg" class="contact-link" target="_blank">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        LinkedIn
      </a>
      <a href="https://twitter.com/anshullgarg" class="contact-link" target="_blank">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        X / Twitter
      </a>
    </div>
  </section>

  <!-- FOOTER -->
  <div class="footer">
    Built with care by Anshull Garg. This portfolio is multiplayer -- you're not alone here.
  </div>

</div>

<!-- NOTE INPUT MODAL -->
<div class="note-input-overlay" id="noteOverlay">
  <div class="note-input-box">
    <h3>Leave a sticky note</h3>
    <textarea id="noteTextarea" maxlength="100" placeholder="Write something nice..."></textarea>
    <div class="char-count"><span id="charCount">0</span>/100</div>
    <div class="note-input-actions">
      <button class="cancel" id="noteCancel">Cancel</button>
      <button class="post" id="notePost">Post Note</button>
    </div>
  </div>
</div>

<!-- REACTION BAR -->
<div class="reaction-bar">
  <button class="reaction-btn" data-emoji="&#x1F525;">&#x1F525;</button>
  <button class="reaction-btn" data-emoji="&#x1F44F;">&#x1F44F;</button>
  <button class="reaction-btn" data-emoji="&#x1F4AF;">&#x1F4AF;</button>
  <button class="reaction-btn" data-emoji="&#x2B50;">&#x2B50;</button>
  <button class="reaction-btn" data-emoji="&#x1F680;">&#x1F680;</button>
  <button class="reaction-btn" data-emoji="&#x1F49C;">&#x1F49C;</button>
</div>

<script>
// ============================================================
//  UTILITY HELPERS
// ============================================================
const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];
const rand = (a, b) => Math.random() * (b - a) + a;
const randInt = (a, b) => Math.floor(rand(a, b + 1));
const pick = arr => arr[randInt(0, arr.length - 1)];
const clamp = (v, lo, hi) => Math.min(hi, Math.max(lo, v));
const lerp = (a, b, t) => a + (b - a) * t;

// ============================================================
//  CURSOR SIMULATION
// ============================================================
const CURSOR_COLORS = ['#F472B6', '#34D399', '#FBBF24', '#A78BFA', '#FB923C', '#38BDF8'];
const CURSOR_NAMES = [
  { name: 'Anonymous Panda', emoji: '\u{1F43C}' },
  { name: 'Curious Fox', emoji: '\u{1F98A}' },
  { name: 'Silent Owl', emoji: '\u{1F989}' },
];

const MESSAGES = [
  'This is so cool!',
  'Nice portfolio',
  'Love the design',
  'Impressive work',
  'Clean layout!',
];

const hoverableEls = () => $$('[data-hoverable]');

class FakeCursor {
  constructor(info, color, delay) {
    this.info = info;
    this.color = color;
    this.x = rand(100, window.innerWidth - 200);
    this.y = rand(200, window.innerHeight - 200);
    this.targetX = this.x;
    this.targetY = this.y;
    this.velX = 0;
    this.velY = 0;
    this.visible = false;
    this.paused = false;
    this.pauseUntil = 0;
    this.hoveredEl = null;
    this.showMessage = false;
    this.messageText = '';
    this.nextTargetTime = 0;
    this.joinDelay = delay;
    this.joined = false;
    this.left = false;

    this.el = document.createElement('div');
    this.el.className = 'fake-cursor hidden';
    this.el.innerHTML = `
      <svg viewBox="0 0 24 24" fill="${this.color}">
        <path d="M5.65 2.1l12.7 12.7-5.5 1.38-3.73 5-1.15-6.6L5.65 2.1z" stroke="rgba(0,0,0,0.3)" stroke-width="1"/>
      </svg>
      <span class="cursor-label" style="background:${this.color};color:#000;">${this.info.name} ${this.info.emoji}</span>
      <span class="cursor-message"></span>
    `;
    document.body.appendChild(this.el);
    this.msgEl = this.el.querySelector('.cursor-message');
  }

  pickNewTarget() {
    // Sometimes target a hoverable element
    if (Math.random() < 0.4) {
      const els = hoverableEls();
      if (els.length) {
        const el = pick(els);
        const r = el.getBoundingClientRect();
        this.targetX = rand(r.left + 20, r.right - 20);
        this.targetY = rand(r.top + 20, r.bottom - 20);
        return;
      }
    }
    this.targetX = rand(80, window.innerWidth - 120);
    this.targetY = rand(100, document.documentElement.scrollHeight - 200);
  }

  update(time) {
    if (!this.joined) {
      if (time < this.joinDelay) return;
      this.joined = true;
      this.visible = true;
      this.el.classList.remove('hidden');
      showToast(`<span class="name">${this.info.name} ${this.info.emoji}</span> joined`);
      updateOnlineCount(1);
    }

    if (this.left) return;

    // Occasional leave/rejoin
    if (!this.leaveScheduled && time > this.joinDelay + 20000) {
      this.leaveScheduled = true;
      this.leaveAt = time + rand(25000, 50000);
    }
    if (this.leaveScheduled && !this.hasLeft && time > this.leaveAt) {
      this.hasLeft = true;
      this.visible = false;
      this.el.classList.add('hidden');
      showToast(`<span class="name">${this.info.name} ${this.info.emoji}</span> left`);
      updateOnlineCount(-1);
      // Rejoin later
      setTimeout(() => {
        this.hasLeft = false;
        this.leaveScheduled = false;
        this.visible = true;
        this.el.classList.remove('hidden');
        showToast(`<span class="name">${this.info.name} ${this.info.emoji}</span> joined`);
        updateOnlineCount(1);
      }, rand(8000, 15000));
      return;
    }

    if (!this.visible) return;

    // Pausing (simulating reading)
    if (this.paused) {
      if (time > this.pauseUntil) this.paused = false;
      else return;
    }

    // Pick new target
    if (time > this.nextTargetTime) {
      this.pickNewTarget();
      this.nextTargetTime = time + rand(2000, 5000);
      // Sometimes pause
      if (Math.random() < 0.25) {
        this.paused = true;
        this.pauseUntil = time + rand(800, 2500);
      }
      // Sometimes show a message
      if (Math.random() < 0.12) {
        this.showMsg(pick(MESSAGES));
      }
    }

    // Smooth easing towards target
    const dx = this.targetX - this.x;
    const dy = this.targetY - this.y;
    const ease = 0.04 + Math.random() * 0.01;
    this.x += dx * ease;
    this.y += dy * ease;

    // Add tiny jitter for realism
    this.x += (Math.random() - 0.5) * 0.3;
    this.y += (Math.random() - 0.5) * 0.3;

    const scrollY = window.scrollY;
    this.el.style.transform = `translate(${this.x}px, ${this.y - scrollY}px)`;

    // Hover detection
    this.checkHover();
  }

  checkHover() {
    const els = hoverableEls();
    let found = null;
    for (const el of els) {
      const r = el.getBoundingClientRect();
      const scrollY = window.scrollY;
      if (this.x > r.left && this.x < r.right && (this.y - scrollY) > r.top && (this.y - scrollY) < r.bottom) {
        found = el;
        break;
      }
    }
    if (found !== this.hoveredEl) {
      if (this.hoveredEl) this.hoveredEl.classList.remove('cursor-hovered');
      this.hoveredEl = found;
      if (found) found.classList.add('cursor-hovered');
    }
  }

  showMsg(text) {
    this.msgEl.textContent = text;
    this.msgEl.classList.add('visible');
    setTimeout(() => this.msgEl.classList.remove('visible'), 3000);
  }
}

// Create cursors
const cursors = CURSOR_NAMES.map((info, i) =>
  new FakeCursor(info, CURSOR_COLORS[i], i * rand(2000, 4000))
);

let startTime = 0;
function animateCursors(timestamp) {
  if (!startTime) startTime = timestamp;
  const elapsed = timestamp - startTime;
  for (const c of cursors) c.update(elapsed);
  requestAnimationFrame(animateCursors);
}
requestAnimationFrame(animateCursors);

// ============================================================
//  TOASTS
// ============================================================
function showToast(html) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = html;
  $('#toastContainer').appendChild(t);
  setTimeout(() => t.remove(), 4000);
}

// ============================================================
//  ONLINE COUNT
// ============================================================
let onlineCount = 1; // you
function updateOnlineCount(delta) {
  onlineCount = Math.max(1, onlineCount + delta);
  $('#onlineCount').textContent = `${onlineCount} visitor${onlineCount !== 1 ? 's' : ''} online`;
}

// Initial arrivals bump the count via FakeCursor.join logic already

// ============================================================
//  STICKY NOTES
// ============================================================
const NOTE_COLORS = [
  '#FDE68A', '#FBCFE8', '#A7F3D0', '#BAE6FD', '#DDD6FE',
  '#FED7AA', '#FECACA', '#C7D2FE',
];

const DEFAULT_NOTES = [
  { text: 'Love this portfolio! \u{1F525}', author: 'Anonymous Panda', x: 60, y: 350, color: '#FDE68A', rot: -3 },
  { text: 'The projects are impressive', author: 'Curious Fox', x: 750, y: 480, color: '#A7F3D0', rot: 2 },
  { text: 'Hire this person!', author: 'Silent Owl', x: 200, y: 1050, color: '#FBCFE8', rot: -1.5 },
  { text: 'Clean code, clean design', author: 'Mighty Bear', x: 680, y: 850, color: '#BAE6FD', rot: 4 },
  { text: 'Multiplayer portfolio? Genius \u{1F4A1}', author: 'Swift Deer', x: 420, y: 1400, color: '#DDD6FE', rot: -2.5 },
  { text: 'Came here from Twitter, WOW', author: 'Bold Eagle', x: 100, y: 1700, color: '#FED7AA', rot: 1.8 },
];

function loadNotes() {
  try {
    const saved = localStorage.getItem('mp-portfolio-notes');
    return saved ? JSON.parse(saved) : null;
  } catch { return null; }
}

function saveNotes(notes) {
  try { localStorage.setItem('mp-portfolio-notes', JSON.stringify(notes)); } catch {}
}

let allNotes = loadNotes() || DEFAULT_NOTES;

function renderNotes() {
  // Remove existing
  $$('.sticky-note').forEach(n => n.remove());

  allNotes.forEach((note, i) => {
    const el = document.createElement('div');
    el.className = 'sticky-note';
    el.style.left = clamp(note.x, 20, window.innerWidth - 220) + 'px';
    el.style.top = note.y + 'px';
    el.style.background = note.color;
    el.style.color = '#1A1A22';
    el.style.transform = `rotate(${note.rot || 0}deg)`;
    el.innerHTML = `
      <button class="note-close" data-idx="${i}">&times;</button>
      <div>${escapeHtml(note.text)}</div>
      <div class="note-author">-- ${escapeHtml(note.author)}</div>
    `;
    // Drag functionality
    makeDraggable(el, i);
    $('#mainContent').appendChild(el);
  });
}

function escapeHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function makeDraggable(el, idx) {
  let startX, startY, origX, origY, dragging = false;

  el.addEventListener('pointerdown', e => {
    if (e.target.classList.contains('note-close')) return;
    dragging = true;
    el.classList.add('dragging');
    startX = e.clientX;
    startY = e.clientY;
    origX = parseFloat(el.style.left);
    origY = parseFloat(el.style.top);
    el.setPointerCapture(e.pointerId);
  });

  el.addEventListener('pointermove', e => {
    if (!dragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    el.style.left = (origX + dx) + 'px';
    el.style.top = (origY + dy) + 'px';
  });

  el.addEventListener('pointerup', e => {
    if (!dragging) return;
    dragging = false;
    el.classList.remove('dragging');
    // Save new position
    allNotes[idx].x = parseFloat(el.style.left);
    allNotes[idx].y = parseFloat(el.style.top);
    saveNotes(allNotes);
  });
}

// Close note
document.addEventListener('click', e => {
  if (e.target.classList.contains('note-close')) {
    const idx = parseInt(e.target.dataset.idx);
    allNotes.splice(idx, 1);
    saveNotes(allNotes);
    renderNotes();
  }
});

renderNotes();

// Leave a note modal
$('#btnLeaveNote').addEventListener('click', () => {
  $('#noteOverlay').classList.add('active');
  $('#noteTextarea').value = '';
  $('#charCount').textContent = '0';
  setTimeout(() => $('#noteTextarea').focus(), 100);
});

$('#noteCancel').addEventListener('click', () => {
  $('#noteOverlay').classList.remove('active');
});

$('#noteOverlay').addEventListener('click', e => {
  if (e.target === $('#noteOverlay')) $('#noteOverlay').classList.remove('active');
});

$('#noteTextarea').addEventListener('input', () => {
  $('#charCount').textContent = $('#noteTextarea').value.length;
});

$('#notePost').addEventListener('click', () => {
  const text = $('#noteTextarea').value.trim();
  if (!text) return;
  const note = {
    text,
    author: 'You',
    x: rand(100, window.innerWidth - 250),
    y: rand(300, 1200),
    color: pick(NOTE_COLORS),
    rot: rand(-5, 5),
  };
  allNotes.push(note);
  saveNotes(allNotes);
  renderNotes();
  $('#noteOverlay').classList.remove('active');
  showToast('Your note was posted!');
});

// ============================================================
//  EMOJI REACTIONS
// ============================================================
const EMOJIS = ['\u{1F525}', '\u{1F44F}', '\u{1F4AF}', '\u2B50', '\u{1F680}', '\u{1F49C}'];

function spawnFloatingEmoji(emoji, x, y) {
  const el = document.createElement('div');
  el.className = 'floating-emoji';
  el.textContent = emoji;
  el.style.left = x + 'px';
  el.style.top = y + 'px';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 2100);
}

// Reaction bar clicks
$$('.reaction-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    const emoji = btn.dataset.emoji;
    const rect = btn.getBoundingClientRect();
    spawnFloatingEmoji(emoji, rect.left + rect.width / 2 - 14, rect.top - 10);
  });
});

// Simulated cursor reactions
function simulatedReaction() {
  const activeCursors = cursors.filter(c => c.visible && c.joined && !c.hasLeft);
  if (activeCursors.length === 0) return;
  const cursor = pick(activeCursors);
  const emoji = pick(EMOJIS);
  const scrollY = window.scrollY;
  spawnFloatingEmoji(emoji, cursor.x, cursor.y - scrollY);
}

setInterval(simulatedReaction, rand(5000, 10000));
// Schedule multiple intervals for variety
setInterval(simulatedReaction, 7500);

// ============================================================
//  VISITOR COUNTER ANIMATION
// ============================================================
let displayCount = 12800;
const targetCount = 12847;
function animateCounter() {
  if (displayCount < targetCount) {
    displayCount += randInt(1, 5);
    if (displayCount > targetCount) displayCount = targetCount;
    $('#totalVisitors').textContent = displayCount.toLocaleString();
    setTimeout(animateCounter, rand(30, 80));
  }
}
setTimeout(animateCounter, 500);

// Slowly increment over time (simulating new visitors)
setInterval(() => {
  displayCount += 1;
  $('#totalVisitors').textContent = displayCount.toLocaleString();
}, rand(15000, 30000));

// Rotate popular section text
const POPULAR_TEXTS = [
  'Projects section is popular right now',
  'Skills section is getting attention',
  'Someone is reading the About section',
  'Contact section just got a visitor',
  'Hero section is the most viewed',
];
let popIdx = 0;
setInterval(() => {
  popIdx = (popIdx + 1) % POPULAR_TEXTS.length;
  $('#popularSection').textContent = POPULAR_TEXTS[popIdx];
}, 8000);

// ============================================================
//  INITIAL TOAST SEQUENCE
// ============================================================
setTimeout(() => showToast('<span class="name">Anonymous Panda \u{1F43C}</span> is viewing Projects'), 6000);
setTimeout(() => showToast('<span class="name">Curious Fox \u{1F98A}</span> left a reaction \u{1F525}'), 12000);
setTimeout(() => showToast('<span class="name">Silent Owl \u{1F989}</span> is reading About'), 18000);

// ============================================================
//  KEYBOARD SHORTCUT (Escape closes modal)
// ============================================================
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') $('#noteOverlay').classList.remove('active');
});

// ============================================================
//  WINDOW RESIZE: Re-clamp note positions
// ============================================================
window.addEventListener('resize', () => {
  $$('.sticky-note').forEach((el, i) => {
    if (allNotes[i]) {
      el.style.left = clamp(allNotes[i].x, 20, window.innerWidth - 220) + 'px';
    }
  });
});
</script>
</body>
</html>
